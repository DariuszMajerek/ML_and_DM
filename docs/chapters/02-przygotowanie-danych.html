<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="pl" xml:lang="pl"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>3&nbsp; Przygotowanie i czyszczenie danych – Eksploracja danych i uczenie maszynowe</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" integrity="sha384-ZvpUoO/+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn/6Z/hRTt8+pR6L4N2" crossorigin="anonymous"></script><script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../chapters/03-klasyfikacja-liniowa.html" rel="next">
<link href="../chapters/01-wprowadzenie.html" rel="prev">
<link href="../images/cover.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark-b758ccaa5987ceb1b75504551e579abf.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-6b8c1b7f874bdd152064db223e7d36ae.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark-7becdd8e1b79f26ea566d6ea537c1a09.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="../site_libs/bootstrap/bootstrap-6b8c1b7f874bdd152064db223e7d36ae.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script src="../site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="../site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "Brak wyników",
    "search-matching-documents-text": "dopasowane dokumenty",
    "search-copy-link-title": "Kopiuj link do wyszukiwania",
    "search-hide-matches-text": "Ukryj dodatkowe dopasowania",
    "search-more-match-text": "więcej dopasowań w tym dokumencie",
    "search-more-matches-text": "więcej dopasowań w tym dokumencie",
    "search-clear-button-title": "Wyczyść",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Anuluj",
    "search-submit-button-title": "Zatwierdź",
    "search-label": "Szukaj"
  }
}</script>
<script src="https://cdn.jsdelivr.net/npm/requirejs@2.3.6/require.min.js" integrity="sha384-c9c+LnTbwQ3aujuU7ULEPVvgLs+Fn6fJUvIGTsuu1ZcCf11fiEubah0ttpca4ntM sha384-6V1/AdqZRWk1KAlWbKBlGhN7VG4iE/yAZcO6NZPMF8od0vukrvr0tg4qY6NSrItx" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating slimcontent quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Przełącz pasek boczny" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../chapters/02-przygotowanie-danych.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Przygotowanie i czyszczenie danych</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Przełącz pasek boczny" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Szukaj" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="../index.html" class="sidebar-logo-link">
      <img src="../images/logo.jpg" alt="" class="sidebar-logo light-content py-0 d-lg-inline d-none">
      <img src="../images/logo.jpg" alt="" class="sidebar-logo dark-content py-0 d-lg-inline d-none">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Eksploracja danych i uczenie maszynowe</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/DariuszMajerek/eksploracja-danych-uczenie-maszynowe" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <a href="https://twitter.com/intent/tweet?url=|url|" title="Twitter" class="quarto-navigation-tool px-1" aria-label="Twitter"><i class="bi bi-twitter"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Przełącz tryb ciemny"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Przełącz tryb czytnika">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Szukaj"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Wstep</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/01-wprowadzenie.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Wprowadzenie i historia</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/02-przygotowanie-danych.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Przygotowanie i czyszczenie danych</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/03-klasyfikacja-liniowa.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Klasyfikacja liniowa</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/04-drzewa-zespoly.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Drzewa decyzyjne i zespoly modeli</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/05-bayes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Klasyfikatory bayesowskie</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/06-knn.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">k-NN</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/07-splajny-gam.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Modele addytywne i splajny</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/08-svm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Metoda SVM</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/09-dalsze-zagadnienia.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Inne metody</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/10-podsumowanie.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Podsumowanie</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Spis treści</h2>
   
  <ul>
  <li><a href="#import-i-czyszczenie-danych" id="toc-import-i-czyszczenie-danych" class="nav-link active" data-scroll-target="#import-i-czyszczenie-danych"><span class="header-section-number">3.1</span> Import i czyszczenie danych</a></li>
  <li><a href="#obserwacje-odstające-i-braki-danych" id="toc-obserwacje-odstające-i-braki-danych" class="nav-link" data-scroll-target="#obserwacje-odstające-i-braki-danych"><span class="header-section-number">3.2</span> Obserwacje odstające i braki danych</a>
  <ul class="collapse">
  <li><a href="#obserwacje-odstające" id="toc-obserwacje-odstające" class="nav-link" data-scroll-target="#obserwacje-odstające"><span class="header-section-number">3.2.1</span> Obserwacje odstające</a></li>
  <li><a href="#braki-danych-i-imputacja" id="toc-braki-danych-i-imputacja" class="nav-link" data-scroll-target="#braki-danych-i-imputacja"><span class="header-section-number">3.2.2</span> Braki danych i imputacja</a></li>
  </ul></li>
  <li><a href="#eda-i-preprocessing-danych" id="toc-eda-i-preprocessing-danych" class="nav-link" data-scroll-target="#eda-i-preprocessing-danych"><span class="header-section-number">3.3</span> EDA i preprocessing danych</a>
  <ul class="collapse">
  <li><a href="#szybki-sanity-check-po-imporcie" id="toc-szybki-sanity-check-po-imporcie" class="nav-link" data-scroll-target="#szybki-sanity-check-po-imporcie"><span class="header-section-number">3.3.1</span> Szybki „sanity check” po imporcie</a></li>
  <li><a href="#eda---rozkłady-i-struktura-zmiennych" id="toc-eda---rozkłady-i-struktura-zmiennych" class="nav-link" data-scroll-target="#eda---rozkłady-i-struktura-zmiennych"><span class="header-section-number">3.3.2</span> EDA - rozkłady i struktura zmiennych</a></li>
  <li><a href="#eda---zależności-między-zmiennymi" id="toc-eda---zależności-między-zmiennymi" class="nav-link" data-scroll-target="#eda---zależności-między-zmiennymi"><span class="header-section-number">3.3.3</span> EDA - zależności między zmiennymi</a></li>
  <li><a href="#preprocessing---przygotowanie-macierzy-cech-do-modeli" id="toc-preprocessing---przygotowanie-macierzy-cech-do-modeli" class="nav-link" data-scroll-target="#preprocessing---przygotowanie-macierzy-cech-do-modeli"><span class="header-section-number">3.3.4</span> Preprocessing - przygotowanie macierzy cech do modeli</a></li>
  </ul></li>
  <li><a href="#inżynieria-cech" id="toc-inżynieria-cech" class="nav-link" data-scroll-target="#inżynieria-cech"><span class="header-section-number">3.4</span> Inżynieria cech</a>
  <ul class="collapse">
  <li><a href="#ujednolicanie-i-czyszczenie-kategorii-jako-element-inżynierii-cech" id="toc-ujednolicanie-i-czyszczenie-kategorii-jako-element-inżynierii-cech" class="nav-link" data-scroll-target="#ujednolicanie-i-czyszczenie-kategorii-jako-element-inżynierii-cech"><span class="header-section-number">3.4.1</span> Ujednolicanie i czyszczenie kategorii jako element inżynierii cech</a></li>
  <li><a href="#cechy-czasowe-z-dat" id="toc-cechy-czasowe-z-dat" class="nav-link" data-scroll-target="#cechy-czasowe-z-dat"><span class="header-section-number">3.4.2</span> Cechy czasowe z dat</a></li>
  <li><a href="#transformacje-rozkładów" id="toc-transformacje-rozkładów" class="nav-link" data-scroll-target="#transformacje-rozkładów"><span class="header-section-number">3.4.3</span> Transformacje rozkładów</a></li>
  <li><a href="#cechy-intensywności-i-normalizacja-przez-czas-rate-features" id="toc-cechy-intensywności-i-normalizacja-przez-czas-rate-features" class="nav-link" data-scroll-target="#cechy-intensywności-i-normalizacja-przez-czas-rate-features"><span class="header-section-number">3.4.4</span> Cechy intensywności i „normalizacja przez czas” (<em>rate features</em>)</a></li>
  <li><a href="#interakcje-i-cechy-biznesowe-z-sensowną-interpretacją" id="toc-interakcje-i-cechy-biznesowe-z-sensowną-interpretacją" class="nav-link" data-scroll-target="#interakcje-i-cechy-biznesowe-z-sensowną-interpretacją"><span class="header-section-number">3.4.5</span> Interakcje i cechy „biznesowe” z sensowną interpretacją</a></li>
  <li><a href="#grupowanie-zmiennych-ciągłych-do-przedziałów-binning" id="toc-grupowanie-zmiennych-ciągłych-do-przedziałów-binning" class="nav-link" data-scroll-target="#grupowanie-zmiennych-ciągłych-do-przedziałów-binning"><span class="header-section-number">3.4.6</span> Grupowanie zmiennych ciągłych do przedziałów (<em>binning</em>)</a></li>
  <li><a href="#kodowanie-kategorii-pod-modele" id="toc-kodowanie-kategorii-pod-modele" class="nav-link" data-scroll-target="#kodowanie-kategorii-pod-modele"><span class="header-section-number">3.4.7</span> Kodowanie kategorii pod modele</a></li>
  <li><a href="#składanie-cech-do-macierzy-modelowej" id="toc-składanie-cech-do-macierzy-modelowej" class="nav-link" data-scroll-target="#składanie-cech-do-macierzy-modelowej"><span class="header-section-number">3.4.8</span> Składanie cech do macierzy modelowej</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/DariuszMajerek/eksploracja-danych-uczenie-maszynowe/issues/new" class="toc-action"><i class="bi bi-github"></i>Zgłoś problem</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Przygotowanie i czyszczenie danych</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Przygotowanie danych stanowi jeden z kluczowych etapów procesu eksploracji danych i uczenia maszynowego. Jakość danych wejściowych w dużej mierze determinuje jakość modeli, niezależnie od stopnia ich złożoności. W praktyce analizy danych etap ten obejmuje zarówno wstępną eksplorację danych, jak i ich transformację, czyszczenie oraz konstrukcję cech, które będą następnie wykorzystywane przez algorytmy uczenia nadzorowanego. W niniejszym rozdziale przygotowanie danych jest traktowane jako proces analityczny, a nie jedynie techniczny etap przetwarzania.</p>
<section id="import-i-czyszczenie-danych" class="level2 page-columns page-full" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="import-i-czyszczenie-danych"><span class="header-section-number">3.1</span> Import i czyszczenie danych</h2>
<p>Import danych jest pierwszym momentem, w którym można świadomie zminimalizować późniejsze problemy jakościowe. W praktyce ważne jest nie tylko „wczytanie pliku”, ale kontrola takich elementów jak kodowanie znaków, separator, typy danych, format dat, niestandardowe znaczniki braków oraz interpretacja wartości logicznych. <code>pandas</code> daje w tym zakresie bardzo duże możliwości, a poprawna konfiguracja importu bywa istotniejsza niż późniejsze „naprawy” wykonywane ad hoc.</p>
<p>Najczęściej spotykanym formatem jest CSV, który bywa myląco prosty: różne pliki mogą używać separatora <code>,</code> lub <code>;</code>, różnych separatorów dziesiętnych (kropka/przecinek), mogą zawierać znaki narodowe (tu: polskie nazwy miast), a braki mogą być kodowane jako puste pole, <code>NA</code>, <code>N/A</code>, <code>null</code>, <code>-999</code> itd. Dlatego przy imporcie CSV bardzo często warto jawnie ustawić: <code>sep</code>, <code>encoding</code>, <code>na_values</code>, <code>parse_dates</code>, a w razie potrzeby także <code>dtype</code>. Przykładowo<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>:</p>
<div class="no-row-height column-margin column-container"><div id="fn1"><p><sup>1</sup>&nbsp;Dane przypominają prosty wycinek danych klient–zakupy. Zawierają zmienne liczbowe (np. <code>income_eur</code>, <code>avg_basket_eur</code>, <code>visits_last30</code>), jakościowe (<code>city</code>, <code>segment</code>, <code>device_type</code>, <code>notes</code>), logiczne (<code>has_promo</code>), daty (<code>signup_date</code>, <code>last_purchase_date</code>) oraz zmienną docelową (<code>churned</code>). Celowo wprowadzono braki danych (w tym puste pola i znaczniki <code>NA</code>), wartości odstające (np. nienaturalnie wysokie dochody, koszyki zakupowe i liczby wizyt) oraz błędy jakościowe (np. wiek 5 i 120, ujemne zwroty, rozbieżności w kodowaniu kategorii: spacje i różne wielkości liter).</p></div></div><div id="1c2ee587" class="cell" data-execution_count="1">
<details open="" class="code-fold">
<summary>Kod</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"data.csv"</span>,</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    encoding<span class="op">=</span><span class="st">"utf-8"</span>,</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    na_values<span class="op">=</span>[<span class="st">""</span>, <span class="st">"NA"</span>, <span class="st">"N/A"</span>, <span class="st">"null"</span>, <span class="st">"None"</span>],</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    parse_dates<span class="op">=</span>[<span class="st">"signup_date"</span>, <span class="st">"last_purchase_date"</span>]</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>df.head()</span></code></pre></div><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="1">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">customer_id</th>
<th data-quarto-table-cell-role="th">signup_date</th>
<th data-quarto-table-cell-role="th">last_purchase_date</th>
<th data-quarto-table-cell-role="th">age</th>
<th data-quarto-table-cell-role="th">income_eur</th>
<th data-quarto-table-cell-role="th">city</th>
<th data-quarto-table-cell-role="th">segment</th>
<th data-quarto-table-cell-role="th">device_type</th>
<th data-quarto-table-cell-role="th">visits_last30</th>
<th data-quarto-table-cell-role="th">avg_basket_eur</th>
<th data-quarto-table-cell-role="th">returns_last90</th>
<th data-quarto-table-cell-role="th">has_promo</th>
<th data-quarto-table-cell-role="th">satisfaction_1_5</th>
<th data-quarto-table-cell-role="th">churned</th>
<th data-quarto-table-cell-role="th">notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>100000</td>
<td>2022-04-08</td>
<td>2022-10-19</td>
<td>NaN</td>
<td>72955.0</td>
<td>Warszawa</td>
<td>B2B</td>
<td>desktop</td>
<td>8.0</td>
<td>39.88</td>
<td>1.0</td>
<td>False</td>
<td>4.0</td>
<td>0</td>
<td>klient powracający</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>100001</td>
<td>2024-04-27</td>
<td>2024-05-13</td>
<td>52.0</td>
<td>24863.0</td>
<td>Kraków</td>
<td>B2C</td>
<td>mobile</td>
<td>12.0</td>
<td>67.80</td>
<td>1.0</td>
<td>False</td>
<td>3.0</td>
<td>0</td>
<td>brak uwag</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>100002</td>
<td>2023-12-18</td>
<td>2024-04-05</td>
<td>NaN</td>
<td>25333.0</td>
<td>Wrocław</td>
<td>B2C</td>
<td>desktop</td>
<td>6.0</td>
<td>27.04</td>
<td>1.0</td>
<td>True</td>
<td>4.0</td>
<td>0</td>
<td>reklamacja</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>100003</td>
<td>2023-04-26</td>
<td>2023-10-01</td>
<td>16.0</td>
<td>NaN</td>
<td>Łódź</td>
<td>B2B</td>
<td>mobile</td>
<td>6.0</td>
<td>149.03</td>
<td>1.0</td>
<td>False</td>
<td>3.0</td>
<td>1</td>
<td>brak uwag</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>100004</td>
<td>2023-04-20</td>
<td>2024-04-07</td>
<td>42.0</td>
<td>27954.0</td>
<td>Warszawa</td>
<td>B2C</td>
<td>desktop</td>
<td>7.0</td>
<td>49.73</td>
<td>1.0</td>
<td>True</td>
<td>3.0</td>
<td>0</td>
<td>NaN</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>W tym przykładzie <code>na_values</code> powoduje, że zarówno puste pola, jak i tekstowe znaczniki braków zostaną zamienione na <code>NaN</code>, a <code>parse_dates</code> zadba o automatyczną konwersję wskazanych kolumn do typu daty. To jest szczególnie ważne, bo daty wczytane jako tekst utrudniają analizę sezonowości, czasu od rejestracji, czy prostych agregacji po miesiącach.</p>
<p>W przypadku danych w Excelu (<code>.xlsx</code>) import odbywa się przez <code>read_excel</code>. W praktyce warto pamiętać, że Excel często zawiera dodatkowe arkusze, nagłówki „opisowe” nad tabelą, albo mieszane typy w kolumnach. Gdy dane są w konkretnym arkuszu i zaczynają się od konkretnego wiersza, przydają się parametry <code>sheet_name</code> oraz <code>skiprows</code>. Dla dołączonego pliku:</p>
<div id="8079474c" class="cell" data-execution_count="2">
<details open="" class="code-fold">
<summary>Kod</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_excel(</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"data.xlsx"</span>,</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    sheet_name<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    na_values<span class="op">=</span>[<span class="st">""</span>, <span class="st">"NA"</span>, <span class="st">"N/A"</span>, <span class="st">"null"</span>, <span class="st">"None"</span>],</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    parse_dates<span class="op">=</span>[<span class="st">"signup_date"</span>, <span class="st">"last_purchase_date"</span>]</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>df.head()</span></code></pre></div><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="2">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">customer_id</th>
<th data-quarto-table-cell-role="th">signup_date</th>
<th data-quarto-table-cell-role="th">last_purchase_date</th>
<th data-quarto-table-cell-role="th">age</th>
<th data-quarto-table-cell-role="th">income_eur</th>
<th data-quarto-table-cell-role="th">city</th>
<th data-quarto-table-cell-role="th">segment</th>
<th data-quarto-table-cell-role="th">device_type</th>
<th data-quarto-table-cell-role="th">visits_last30</th>
<th data-quarto-table-cell-role="th">avg_basket_eur</th>
<th data-quarto-table-cell-role="th">returns_last90</th>
<th data-quarto-table-cell-role="th">has_promo</th>
<th data-quarto-table-cell-role="th">satisfaction_1_5</th>
<th data-quarto-table-cell-role="th">churned</th>
<th data-quarto-table-cell-role="th">notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>100000</td>
<td>2022-04-08</td>
<td>2022-10-19</td>
<td>NaN</td>
<td>72955.0</td>
<td>Warszawa</td>
<td>B2B</td>
<td>desktop</td>
<td>8</td>
<td>39.88</td>
<td>1</td>
<td>False</td>
<td>4.0</td>
<td>0</td>
<td>klient powracający</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>100001</td>
<td>2024-04-27</td>
<td>2024-05-13</td>
<td>52.0</td>
<td>24863.0</td>
<td>Kraków</td>
<td>B2C</td>
<td>mobile</td>
<td>12</td>
<td>67.80</td>
<td>1</td>
<td>False</td>
<td>3.0</td>
<td>0</td>
<td>brak uwag</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>100002</td>
<td>2023-12-18</td>
<td>2024-04-05</td>
<td>NaN</td>
<td>25333.0</td>
<td>Wrocław</td>
<td>B2C</td>
<td>desktop</td>
<td>6</td>
<td>27.04</td>
<td>1</td>
<td>True</td>
<td>4.0</td>
<td>0</td>
<td>reklamacja</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>100003</td>
<td>2023-04-26</td>
<td>2023-10-01</td>
<td>16.0</td>
<td>NaN</td>
<td>Łódź</td>
<td>B2B</td>
<td>mobile</td>
<td>6</td>
<td>149.03</td>
<td>1</td>
<td>False</td>
<td>3.0</td>
<td>1</td>
<td>brak uwag</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>100004</td>
<td>2023-04-20</td>
<td>2024-04-07</td>
<td>42.0</td>
<td>27954.0</td>
<td>Warszawa</td>
<td>B2C</td>
<td>desktop</td>
<td>7</td>
<td>49.73</td>
<td>1</td>
<td>True</td>
<td>3.0</td>
<td>0</td>
<td>NaN</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Klasyczny format JSON (<code>.json</code>) przechowuje dane jako jedną spójną strukturę, najczęściej listę obiektów (rekordów). Taki zapis jest szczególnie często spotykany w interfejsach API, plikach konfiguracyjnych oraz w wymianie danych pomiędzy systemami informatycznymi. Z punktu widzenia analizy danych format ten jest bardziej „opisowy” i czytelny dla człowieka, ale jednocześnie wymaga załadowania całej struktury do pamięci.</p>
<p>W przygotowanym pliku <code>data.json</code> dane zapisane są jako lista rekordów, gdzie każdy rekord odpowiada jednej obserwacji, a klucze obiektów odpowiadają nazwom zmiennych. Taki układ bardzo naturalnie mapuje się na strukturę ramki danych w <code>pandas</code>. Podstawowy import danych JSON do pandas odbywa się za pomocą funkcji <code>read_json</code>.</p>
<div id="86f90061" class="cell" data-execution_count="3">
<details open="" class="code-fold">
<summary>Kod</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_json(<span class="st">"data.json"</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>df.head()</span></code></pre></div><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="3">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">customer_id</th>
<th data-quarto-table-cell-role="th">signup_date</th>
<th data-quarto-table-cell-role="th">last_purchase_date</th>
<th data-quarto-table-cell-role="th">age</th>
<th data-quarto-table-cell-role="th">income_eur</th>
<th data-quarto-table-cell-role="th">city</th>
<th data-quarto-table-cell-role="th">segment</th>
<th data-quarto-table-cell-role="th">device_type</th>
<th data-quarto-table-cell-role="th">visits_last30</th>
<th data-quarto-table-cell-role="th">avg_basket_eur</th>
<th data-quarto-table-cell-role="th">returns_last90</th>
<th data-quarto-table-cell-role="th">has_promo</th>
<th data-quarto-table-cell-role="th">satisfaction_1_5</th>
<th data-quarto-table-cell-role="th">churned</th>
<th data-quarto-table-cell-role="th">notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>100000</td>
<td>1649376000000</td>
<td>1666137600000</td>
<td>NaN</td>
<td>72955.0</td>
<td>Warszawa</td>
<td>B2B</td>
<td>desktop</td>
<td>8</td>
<td>39.88</td>
<td>1</td>
<td>False</td>
<td>4.0</td>
<td>0</td>
<td>klient powracający</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>100001</td>
<td>1714176000000</td>
<td>1715558400000</td>
<td>52.0</td>
<td>24863.0</td>
<td>Kraków</td>
<td>B2C</td>
<td>mobile</td>
<td>12</td>
<td>67.80</td>
<td>1</td>
<td>False</td>
<td>3.0</td>
<td>0</td>
<td>brak uwag</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>100002</td>
<td>1702857600000</td>
<td>1712275200000</td>
<td>NaN</td>
<td>25333.0</td>
<td>Wrocław</td>
<td>B2C</td>
<td>desktop</td>
<td>6</td>
<td>27.04</td>
<td>1</td>
<td>True</td>
<td>4.0</td>
<td>0</td>
<td>reklamacja</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>100003</td>
<td>1682467200000</td>
<td>1696118400000</td>
<td>16.0</td>
<td>NaN</td>
<td>Łódź</td>
<td>B2B</td>
<td>mobile</td>
<td>6</td>
<td>149.03</td>
<td>1</td>
<td>False</td>
<td>3.0</td>
<td>1</td>
<td>brak uwag</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>100004</td>
<td>1681948800000</td>
<td>1712448000000</td>
<td>42.0</td>
<td>27954.0</td>
<td>Warszawa</td>
<td>B2C</td>
<td>desktop</td>
<td>7</td>
<td>49.73</td>
<td>1</td>
<td>True</td>
<td>3.0</td>
<td>0</td>
<td>NA</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Po wczytaniu danych <code>pandas</code> automatycznie spróbuje rozpoznać typy zmiennych, jednak – podobnie jak w przypadku CSV – nie zawsze zrobi to zgodnie z oczekiwaniami analityka. W szczególności kolumny datowe są często wczytywane jako typ <code>object</code>, dlatego dobrą praktyką jest ich jawna konwersja:</p>
<div id="9639eb65" class="cell" data-execution_count="4">
<details open="" class="code-fold">
<summary>Kod</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"signup_date"</span>] <span class="op">=</span> pd.to_datetime(df[<span class="st">"signup_date"</span>], errors<span class="op">=</span><span class="st">"coerce"</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"last_purchase_date"</span>] <span class="op">=</span> pd.to_datetime(df[<span class="st">"last_purchase_date"</span>], errors<span class="op">=</span><span class="st">"coerce"</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>df.head()</span></code></pre></div><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="4">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">customer_id</th>
<th data-quarto-table-cell-role="th">signup_date</th>
<th data-quarto-table-cell-role="th">last_purchase_date</th>
<th data-quarto-table-cell-role="th">age</th>
<th data-quarto-table-cell-role="th">income_eur</th>
<th data-quarto-table-cell-role="th">city</th>
<th data-quarto-table-cell-role="th">segment</th>
<th data-quarto-table-cell-role="th">device_type</th>
<th data-quarto-table-cell-role="th">visits_last30</th>
<th data-quarto-table-cell-role="th">avg_basket_eur</th>
<th data-quarto-table-cell-role="th">returns_last90</th>
<th data-quarto-table-cell-role="th">has_promo</th>
<th data-quarto-table-cell-role="th">satisfaction_1_5</th>
<th data-quarto-table-cell-role="th">churned</th>
<th data-quarto-table-cell-role="th">notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>100000</td>
<td>1970-01-01 00:27:29.376000</td>
<td>1970-01-01 00:27:46.137600</td>
<td>NaN</td>
<td>72955.0</td>
<td>Warszawa</td>
<td>B2B</td>
<td>desktop</td>
<td>8</td>
<td>39.88</td>
<td>1</td>
<td>False</td>
<td>4.0</td>
<td>0</td>
<td>klient powracający</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>100001</td>
<td>1970-01-01 00:28:34.176000</td>
<td>1970-01-01 00:28:35.558400</td>
<td>52.0</td>
<td>24863.0</td>
<td>Kraków</td>
<td>B2C</td>
<td>mobile</td>
<td>12</td>
<td>67.80</td>
<td>1</td>
<td>False</td>
<td>3.0</td>
<td>0</td>
<td>brak uwag</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>100002</td>
<td>1970-01-01 00:28:22.857600</td>
<td>1970-01-01 00:28:32.275200</td>
<td>NaN</td>
<td>25333.0</td>
<td>Wrocław</td>
<td>B2C</td>
<td>desktop</td>
<td>6</td>
<td>27.04</td>
<td>1</td>
<td>True</td>
<td>4.0</td>
<td>0</td>
<td>reklamacja</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>100003</td>
<td>1970-01-01 00:28:02.467200</td>
<td>1970-01-01 00:28:16.118400</td>
<td>16.0</td>
<td>NaN</td>
<td>Łódź</td>
<td>B2B</td>
<td>mobile</td>
<td>6</td>
<td>149.03</td>
<td>1</td>
<td>False</td>
<td>3.0</td>
<td>1</td>
<td>brak uwag</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>100004</td>
<td>1970-01-01 00:28:01.948800</td>
<td>1970-01-01 00:28:32.448000</td>
<td>42.0</td>
<td>27954.0</td>
<td>Warszawa</td>
<td>B2C</td>
<td>desktop</td>
<td>7</td>
<td>49.73</td>
<td>1</td>
<td>True</td>
<td>3.0</td>
<td>0</td>
<td>NA</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Parametr <code>errors="coerce"</code> powoduje, że ewentualne niepoprawne formaty dat zostaną zamienione na <code>NaT</code>, co jest bezpieczniejsze niż przerwanie importu błędem. W kontekście eksploracji danych takie zachowanie pozwala szybko zidentyfikować problemy jakościowe bez utraty całego zbioru. Warto podkreślić, że format JSON nie posiada natywnego pojęcia braków danych w sensie znanym z analizy statystycznej. Braki mogą być reprezentowane jako <code>null</code>, brak klucza lub wartość tekstowa (np. <code>NA</code>). <code>pandas</code> zamienia <code>null</code> na <code>NaN</code>, ale nie rozpoznaje automatycznie tekstowych znaczników braków. Dlatego po imporcie zalecane jest jawne czyszczenie takich wartości:</p>
<div id="0806d7cc" class="cell" data-execution_count="5">
<details open="" class="code-fold">
<summary>Kod</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>df.replace([<span class="st">"NA"</span>, <span class="st">"N/A"</span>, <span class="st">""</span>], pd.NA, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>df.head()</span></code></pre></div><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="5">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">customer_id</th>
<th data-quarto-table-cell-role="th">signup_date</th>
<th data-quarto-table-cell-role="th">last_purchase_date</th>
<th data-quarto-table-cell-role="th">age</th>
<th data-quarto-table-cell-role="th">income_eur</th>
<th data-quarto-table-cell-role="th">city</th>
<th data-quarto-table-cell-role="th">segment</th>
<th data-quarto-table-cell-role="th">device_type</th>
<th data-quarto-table-cell-role="th">visits_last30</th>
<th data-quarto-table-cell-role="th">avg_basket_eur</th>
<th data-quarto-table-cell-role="th">returns_last90</th>
<th data-quarto-table-cell-role="th">has_promo</th>
<th data-quarto-table-cell-role="th">satisfaction_1_5</th>
<th data-quarto-table-cell-role="th">churned</th>
<th data-quarto-table-cell-role="th">notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>100000</td>
<td>1970-01-01 00:27:29.376000</td>
<td>1970-01-01 00:27:46.137600</td>
<td>NaN</td>
<td>72955.0</td>
<td>Warszawa</td>
<td>B2B</td>
<td>desktop</td>
<td>8</td>
<td>39.88</td>
<td>1</td>
<td>False</td>
<td>4.0</td>
<td>0</td>
<td>klient powracający</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>100001</td>
<td>1970-01-01 00:28:34.176000</td>
<td>1970-01-01 00:28:35.558400</td>
<td>52.0</td>
<td>24863.0</td>
<td>Kraków</td>
<td>B2C</td>
<td>mobile</td>
<td>12</td>
<td>67.80</td>
<td>1</td>
<td>False</td>
<td>3.0</td>
<td>0</td>
<td>brak uwag</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>100002</td>
<td>1970-01-01 00:28:22.857600</td>
<td>1970-01-01 00:28:32.275200</td>
<td>NaN</td>
<td>25333.0</td>
<td>Wrocław</td>
<td>B2C</td>
<td>desktop</td>
<td>6</td>
<td>27.04</td>
<td>1</td>
<td>True</td>
<td>4.0</td>
<td>0</td>
<td>reklamacja</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>100003</td>
<td>1970-01-01 00:28:02.467200</td>
<td>1970-01-01 00:28:16.118400</td>
<td>16.0</td>
<td>NaN</td>
<td>Łódź</td>
<td>B2B</td>
<td>mobile</td>
<td>6</td>
<td>149.03</td>
<td>1</td>
<td>False</td>
<td>3.0</td>
<td>1</td>
<td>brak uwag</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>100004</td>
<td>1970-01-01 00:28:01.948800</td>
<td>1970-01-01 00:28:32.448000</td>
<td>42.0</td>
<td>27954.0</td>
<td>Warszawa</td>
<td>B2C</td>
<td>desktop</td>
<td>7</td>
<td>49.73</td>
<td>1</td>
<td>True</td>
<td>3.0</td>
<td>0</td>
<td>&lt;NA&gt;</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>W porównaniu do CSV, format JSON lepiej zachowuje strukturę danych (np. brak problemów z separatorami czy kodowaniem znaków), ale gorzej skaluje się dla bardzo dużych zbiorów. Z tego względu klasyczny JSON jest szczególnie przydatny w dydaktyce oraz w pracy z danymi średniej wielkości, gdzie czytelność i jednoznaczność struktury są ważniejsze niż wydajność. Z perspektywy dalszych etapów kursu istotne jest, aby rozumieć, że import danych nie jest neutralnym technicznie krokiem, lecz pierwszym momentem, w którym podejmowane są decyzje wpływające na całą analizę. Różnice pomiędzy CSV, JSONL i JSON przekładają się nie tylko na sposób wczytania danych, ale także na późniejsze możliwości ich walidacji, przetwarzania i skalowania.￼</p>
<p>W praktyce import często wymaga kontroli typów. Jeśli np. identyfikator klienta ma wyglądać jak liczba, ale nie wolno dopuścić do utraty wiodących zer (częsty przypadek dla kodów), należy wymusić typ tekstowy przez <code>dtype={"customer_id": "string"}</code>. W tym konkretnym zbiorze <code>customer_id</code> jest liczbowy, ale w realnych danych biznesowych to częsty problem. Analogicznie, gdy w jednej kolumnie występują liczby i tekst (np. „brak”), <code>pandas</code> może ustawić typ object, a to utrudni obliczenia – lepiej wczytać z <code>na_values</code> i później rzutować typy jawnie.</p>
<p>Istotne są też parametry wpływające na wydajność i kontrolę pamięci. Dla dużych plików CSV warto rozważyć <code>usecols</code> (czytać tylko potrzebne kolumny), <code>chunksize</code> (czytanie porcjami) oraz <code>low_memory=False</code> (mniej błędnych inferencji typów kosztem RAM). Przykład importu porcjami:</p>
<div id="717228d2" class="cell" data-execution_count="6">
<details open="" class="code-fold">
<summary>Kod</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>chunks <span class="op">=</span> pd.read_csv(<span class="st">"data.csv"</span>, chunksize<span class="op">=</span><span class="dv">50_000</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> chunk <span class="kw">in</span> chunks:</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># walidacje / czyszczenie / zapis częściowy</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">pass</span></span></code></pre></div><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<p>Na końcu, dobrą praktyką po imporcie jest natychmiastowa „kontrola jakości importu”: <code>df.info()</code>, <code>df.isna().sum()</code>, sprawdzenie liczby unikatów w kategoriach oraz szybkie oględziny podejrzanych wartości (np. wiek 120). To pozwala wcześnie odróżnić problemy wynikające z danych od problemów wynikających z błędnego importu.</p>
<p>W praktyce analizy danych bardzo często spotyka się zbiory danych, których nazwy kolumn są niewygodne lub wręcz problematyczne z punktu widzenia języka Python oraz bibliotek analitycznych. Dotyczy to w szczególności nazw zawierających spacje, znaki specjalne, polskie znaki diakrytyczne, rozpoczynających się od cyfr, a także nazw bardzo długich lub opisowych. Choć <code>pandas</code> technicznie dopuszcza niemal dowolne nazwy kolumn, ich nieprzemyślane użycie prowadzi do błędów, nieczytelnego kodu oraz problemów w dalszych etapach analizy i modelowania. Problem ten ujawnia się szczególnie wyraźnie wtedy, gdy użytkownik próbuje korzystać z notacji kropkowej (<code>df.column_name</code>), budować formuły modelowe, pisać potoki przetwarzania lub eksportować dane do innych narzędzi analitycznych. Nazwy kolumn zawierające spacje, znaki <code>-</code>, <code>%</code>, <code>()</code>, <code>#</code>, rozpoczynające się od cyfr lub zawierające znaki typowe dla języków innych niż angielski (np. ś, ć, ń) nie mogą być używane jako poprawne identyfikatory w Pythonie. W efekcie kod staje się mniej czytelny i bardziej podatny na błędy.</p>
<p>Rozważmy przykładowy zbiór danych, w którym nazwy kolumn zostały nadane w sposób typowy dla arkuszy Excel lub raportów biznesowych:</p>
<div id="745ed373" class="cell" data-execution_count="7">
<details open="" class="code-fold">
<summary>Kod</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>df2 <span class="op">=</span> pd.DataFrame({</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Customer ID"</span>: [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>],</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"2023 Revenue (€)"</span>: [<span class="dv">12000</span>, <span class="dv">34000</span>, <span class="dv">18000</span>],</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Avg Basket Value"</span>: [<span class="fl">45.5</span>, <span class="fl">78.2</span>, <span class="fl">33.1</span>],</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"% Return"</span>: [<span class="fl">0.02</span>, <span class="fl">0.01</span>, <span class="fl">0.05</span>],</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Very long column name describing customer behaviour in detail"</span>: [<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>]</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>df2</span></code></pre></div><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="6">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Customer ID</th>
<th data-quarto-table-cell-role="th">2023 Revenue (€)</th>
<th data-quarto-table-cell-role="th">Avg Basket Value</th>
<th data-quarto-table-cell-role="th">% Return</th>
<th data-quarto-table-cell-role="th">Very long column name describing customer behaviour in detail</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>1</td>
<td>12000</td>
<td>45.5</td>
<td>0.02</td>
<td>1</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>2</td>
<td>34000</td>
<td>78.2</td>
<td>0.01</td>
<td>0</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>3</td>
<td>18000</td>
<td>33.1</td>
<td>0.05</td>
<td>1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Z punktu widzenia <code>pandas</code> taki zbiór danych jest poprawny, jednak już próba użycia notacji kropkowej zakończy się błędem:</p>
<div id="af2a5b4b" class="cell" data-execution_count="8">
<details open="" class="code-fold">
<summary>Kod</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>df2<span class="fl">.2023</span> Revenue (€) <span class="co"># błąd składni</span></span></code></pre></div><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-cyan-fg">  Cell </span><span class="ansi-green-fg">In[7], line 1</span>
<span class="ansi-red-fg">    df2.2023 Revenue (€) # błąd składni</span>
                      ^
<span class="ansi-red-fg">SyntaxError</span><span class="ansi-red-fg">:</span> invalid character '€' (U+20AC)
</pre>
</div>
</div>
</div>
<p>Każdorazowo konieczne byłoby odwoływanie się do kolumn przez nawiasy i łańcuchy znaków, co znacząco obniża czytelność kodu:</p>
<div id="ebf1bdd5" class="cell" data-execution_count="9">
<details open="" class="code-fold">
<summary>Kod</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>df2[<span class="st">"2023 Revenue (€)"</span>].mean()</span></code></pre></div><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre><code>np.float64(21333.333333333332)</code></pre>
</div>
</div>
<p>Dlatego dobrą praktyką w analizie danych jest normalizacja nazw kolumn bezpośrednio po imporcie danych. Najczęściej stosowana konwencja obejmuje użycie wyłącznie małych liter, znaków ASCII, podkreśleń zamiast spacji oraz nazw rozpoczynających się literą. Taki styl jest zgodny z konwencją <code>snake_case</code> powszechnie stosowaną w Pythonie. Podstawowa korekta nazw kolumn może zostać wykonana w kilku krokach. Najpierw usuwa się nadmiarowe spacje, zamienia litery na małe, a spacje na podkreślenia:</p>
<div id="f80fbd7c" class="cell" data-execution_count="10">
<details open="" class="code-fold">
<summary>Kod</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>df2.columns <span class="op">=</span> (</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    df2.columns</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">str</span>.strip()</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">str</span>.lower()</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">str</span>.replace(<span class="vs">r"</span><span class="dv">\s</span><span class="op">+</span><span class="vs">"</span>, <span class="st">"_"</span>, regex<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<p>Jednak w praktyce to zwykle nie wystarcza, ponieważ w nazwach mogą występować znaki specjalne, symbole walut, procenty czy nawiasy. W takim przypadku warto usunąć wszystkie znaki niedozwolone i pozostawić jedynie litery, cyfry i podkreślenia:</p>
<div id="7ec9453c" class="cell" data-execution_count="11">
<details open="" class="code-fold">
<summary>Kod</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>df2.columns <span class="op">=</span> df2.columns.<span class="bu">str</span>.replace(<span class="vs">r"</span><span class="pp">[^a-zA-Z0-9_]</span><span class="vs">"</span>, <span class="st">""</span>, regex<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co"># opcjonalnie: porządkujemy podkreślenia (np. po usunięciu znaków specjalnych)</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>df2.columns <span class="op">=</span> (</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    df2.columns</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">str</span>.replace(<span class="vs">r"_</span><span class="op">+</span><span class="vs">"</span>, <span class="st">"_"</span>, regex<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">str</span>.strip(<span class="st">"_"</span>)</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>df2.columns</span></code></pre></div><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre><code>Index(['customer_id', '2023_revenue', 'avg_basket_value', 'return',
       'very_long_column_name_describing_customer_behaviour_in_detail'],
      dtype='object')</code></pre>
</div>
</div>
<p>Warto zauważyć, że po czyszczeniu może powstać nazwa będąca słowem kluczowym Pythona (np. <code>return</code>). Jeśli zależy nam na możliwości użycia notacji kropkowej, warto takie przypadki automatycznie zmienić, np. przez dodanie sufiksu:</p>
<div id="e01f2f58" class="cell" data-execution_count="12">
<details open="" class="code-fold">
<summary>Kod</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> keyword</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>df2.columns <span class="op">=</span> [</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    <span class="ss">f"</span><span class="sc">{</span>c<span class="sc">}</span><span class="ss">_var"</span> <span class="cf">if</span> keyword.iskeyword(c) <span class="cf">else</span> c</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> c <span class="kw">in</span> df2.columns</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>]</span></code></pre></div><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<p>Wciąż jednak pozostaje problem nazw rozpoczynających się od cyfr. W Pythonie identyfikator nie może zaczynać się od liczby, dlatego zaleca się automatyczne dodanie prefiksu, na przykład <code>x_</code>:</p>
<div id="30e14dc2" class="cell" data-execution_count="13">
<details open="" class="code-fold">
<summary>Kod</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>df2.columns <span class="op">=</span> [</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>    <span class="ss">f"x_</span><span class="sc">{</span>c<span class="sc">}</span><span class="ss">"</span> <span class="cf">if</span> (c <span class="op">!=</span> <span class="st">""</span> <span class="kw">and</span> c[<span class="dv">0</span>].isdigit()) <span class="cf">else</span> c</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> c <span class="kw">in</span> df2.columns</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>df2.columns</span></code></pre></div><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="12">
<pre><code>Index(['customer_id', 'x_2023_revenue', 'avg_basket_value', 'return_var',
       'very_long_column_name_describing_customer_behaviour_in_detail'],
      dtype='object')</code></pre>
</div>
</div>
<p>Kolejnym, często niedocenianym problemem są zbyt długie nazwy kolumn. Choć technicznie są poprawne, znacząco utrudniają pracę z kodem, zwłaszcza w dalszych etapach, takich jak budowa modeli, interpretacja współczynników czy wizualizacja wyników. W takich sytuacjach dobrą praktyką jest ręczne lub półautomatyczne skracanie nazw, przy zachowaniu ich semantyki:</p>
<div id="db28483b" class="cell" data-execution_count="14">
<details open="" class="code-fold">
<summary>Kod</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>df2 <span class="op">=</span> df2.rename(columns<span class="op">=</span>{</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"very_long_column_name_describing_customer_behaviour_in_detail"</span>: <span class="st">"customer_behavior_flag"</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>df2.columns</span></code></pre></div><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre><code>Index(['customer_id', 'x_2023_revenue', 'avg_basket_value', 'return_var',
       'customer_behavior_flag'],
      dtype='object')</code></pre>
</div>
</div>
<p>W projektach analitycznych o większej skali często stosuje się funkcję pomocniczą, która automatycznie „czyści” nazwy kolumn według ustalonej reguły:</p>
<div id="ef93add0" class="cell" data-execution_count="15">
<details open="" class="code-fold">
<summary>Kod</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>df2 <span class="op">=</span> pd.DataFrame({</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Customer ID"</span>: [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>],</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"2023 Revenue (€)"</span>: [<span class="dv">12000</span>, <span class="dv">34000</span>, <span class="dv">18000</span>],</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Avg Basket Value"</span>: [<span class="fl">45.5</span>, <span class="fl">78.2</span>, <span class="fl">33.1</span>],</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"% Return"</span>: [<span class="fl">0.02</span>, <span class="fl">0.01</span>, <span class="fl">0.05</span>],</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Very long column name describing customer behaviour in detail"</span>: [<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>]</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> clean_column_names(df, max_len<span class="op">=</span><span class="dv">40</span>):</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>    cleaned <span class="op">=</span> (</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>        pd.Index(df.columns).<span class="bu">map</span>(<span class="bu">str</span>)</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>        .<span class="bu">str</span>.strip()</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>        .<span class="bu">str</span>.lower()</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>        .<span class="bu">str</span>.replace(<span class="vs">r"</span><span class="dv">\s</span><span class="op">+</span><span class="vs">"</span>, <span class="st">"_"</span>, regex<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>        .<span class="bu">str</span>.replace(<span class="vs">r"</span><span class="pp">[^a-z0-9_]</span><span class="vs">"</span>, <span class="st">""</span>, regex<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>        .<span class="bu">str</span>.replace(<span class="vs">r"_</span><span class="op">+</span><span class="vs">"</span>, <span class="st">"_"</span>, regex<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>        .<span class="bu">str</span>.strip(<span class="st">"_"</span>)</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>    seen <span class="op">=</span> {}</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>    final_cols <span class="op">=</span> []</span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> c <span class="kw">in</span> cleaned:</span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>        <span class="co"># pusta nazwa po czyszczeniu</span></span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> c <span class="op">==</span> <span class="st">""</span>:</span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>            c <span class="op">=</span> <span class="st">"col"</span></span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>        <span class="co"># nazwa zaczyna się od cyfry</span></span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> c[<span class="dv">0</span>].isdigit():</span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a>            c <span class="op">=</span> <span class="ss">f"x_</span><span class="sc">{</span>c<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># słowo kluczowe Pythona</span></span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> keyword.iskeyword(c):</span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a>            c <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>c<span class="sc">}</span><span class="ss">_var"</span></span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a>        <span class="co"># opcjonalnie: skracamy bardzo długie nazwy (np. do pracy z modelami/tabelami)</span></span>
<span id="cb19-36"><a href="#cb19-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> max_len <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span> <span class="kw">and</span> <span class="bu">len</span>(c) <span class="op">&gt;</span> max_len:</span>
<span id="cb19-37"><a href="#cb19-37" aria-hidden="true" tabindex="-1"></a>            c <span class="op">=</span> c[:max_len].rstrip(<span class="st">"_"</span>)</span>
<span id="cb19-38"><a href="#cb19-38" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> c <span class="op">==</span> <span class="st">""</span>:</span>
<span id="cb19-39"><a href="#cb19-39" aria-hidden="true" tabindex="-1"></a>                c <span class="op">=</span> <span class="st">"col"</span></span>
<span id="cb19-40"><a href="#cb19-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-41"><a href="#cb19-41" aria-hidden="true" tabindex="-1"></a>        <span class="co"># unikamy kolizji nazw (np. dwie różne kolumny mogą się „zlać” po czyszczeniu)</span></span>
<span id="cb19-42"><a href="#cb19-42" aria-hidden="true" tabindex="-1"></a>        count <span class="op">=</span> seen.get(c, <span class="dv">0</span>)</span>
<span id="cb19-43"><a href="#cb19-43" aria-hidden="true" tabindex="-1"></a>        seen[c] <span class="op">=</span> count <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb19-44"><a href="#cb19-44" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> count <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb19-45"><a href="#cb19-45" aria-hidden="true" tabindex="-1"></a>            suffix <span class="op">=</span> <span class="ss">f"_</span><span class="sc">{</span>count<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">"</span></span>
<span id="cb19-46"><a href="#cb19-46" aria-hidden="true" tabindex="-1"></a>            base <span class="op">=</span> c</span>
<span id="cb19-47"><a href="#cb19-47" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> max_len <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span> <span class="kw">and</span> <span class="bu">len</span>(base) <span class="op">+</span> <span class="bu">len</span>(suffix) <span class="op">&gt;</span> max_len:</span>
<span id="cb19-48"><a href="#cb19-48" aria-hidden="true" tabindex="-1"></a>                base <span class="op">=</span> base[: max_len <span class="op">-</span> <span class="bu">len</span>(suffix)].rstrip(<span class="st">"_"</span>)</span>
<span id="cb19-49"><a href="#cb19-49" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> base <span class="op">==</span> <span class="st">""</span>:</span>
<span id="cb19-50"><a href="#cb19-50" aria-hidden="true" tabindex="-1"></a>                    base <span class="op">=</span> <span class="st">"col"</span></span>
<span id="cb19-51"><a href="#cb19-51" aria-hidden="true" tabindex="-1"></a>            c <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>base<span class="sc">}{</span>suffix<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb19-52"><a href="#cb19-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-53"><a href="#cb19-53" aria-hidden="true" tabindex="-1"></a>        final_cols.append(c)</span>
<span id="cb19-54"><a href="#cb19-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-55"><a href="#cb19-55" aria-hidden="true" tabindex="-1"></a>    df.columns <span class="op">=</span> final_cols</span>
<span id="cb19-56"><a href="#cb19-56" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span>
<span id="cb19-57"><a href="#cb19-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-58"><a href="#cb19-58" aria-hidden="true" tabindex="-1"></a>df2 <span class="op">=</span> clean_column_names(df2, max_len <span class="op">=</span> <span class="dv">22</span>)</span>
<span id="cb19-59"><a href="#cb19-59" aria-hidden="true" tabindex="-1"></a>df2</span></code></pre></div><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="14">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">customer_id</th>
<th data-quarto-table-cell-role="th">x_2023_revenue</th>
<th data-quarto-table-cell-role="th">avg_basket_value</th>
<th data-quarto-table-cell-role="th">return_var</th>
<th data-quarto-table-cell-role="th">very_long_column_name</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>1</td>
<td>12000</td>
<td>45.5</td>
<td>0.02</td>
<td>1</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>2</td>
<td>34000</td>
<td>78.2</td>
<td>0.01</td>
<td>0</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>3</td>
<td>18000</td>
<td>33.1</td>
<td>0.05</td>
<td>1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Takie podejście sprawia, że już na wczesnym etapie analizy dane zostają dostosowane do dalszej pracy z modelami, formułami i potokami przetwarzania. Co istotne, normalizacja nazw kolumn nie jest kosmetyką, lecz elementem przygotowania danych, który wpływa na czytelność, reprodukowalność oraz odporność kodu na błędy.</p>
<p>W kontekście tego kursu warto podkreślić, że praca z „brudnymi” nazwami kolumn jest codziennością analityka danych. Umiejętność ich systematycznego korygowania powinna być traktowana na równi z obsługą braków danych czy standaryzacją zmiennych. Jest to jeden z pierwszych kroków w kierunku tworzenia stabilnych i profesjonalnych analiz.</p>
</section>
<section id="obserwacje-odstające-i-braki-danych" class="level2 page-columns page-full" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="obserwacje-odstające-i-braki-danych"><span class="header-section-number">3.2</span> Obserwacje odstające i braki danych</h2>
<p>W praktyce analizy danych obserwacje odstające oraz braki danych są jednymi z najczęstszych źródeł błędnych wniosków i niestabilnych modeli. W EDA traktujemy je jako sygnał diagnostyczny: mogą oznaczać błędy pomiaru lub wprowadzania danych, ale mogą też być prawdziwymi rzadkimi zdarzeniami (np. klienci o bardzo wysokich dochodach). W modelowaniu ML odstające wartości i braki wpływają na estymację parametrów, stabilność uczenia i jakość generalizacji; dlatego kluczowe jest, aby postępowanie z nimi było konsekwentne, udokumentowane oraz wykonywane bez wycieku informacji (wszystkie „uczące się” transformacje dopasowujemy tylko na zbiorze treningowym).</p>
<section id="obserwacje-odstające" class="level3 page-columns page-full" data-number="3.2.1">
<h3 data-number="3.2.1" class="anchored" data-anchor-id="obserwacje-odstające"><span class="header-section-number">3.2.1</span> Obserwacje odstające</h3>
<p>Obserwacje odstające (<em>outliers</em>) to wartości, które są „nietypowe” względem reszty danych. „Nietypowość” trzeba rozumieć w kontekście: może wynikać z rozkładu, jednostki miary, specyfiki biznesowej oraz tego, jakiego modelu używamy. W EDA zwykle rozróżnia się: (1) odstające wartości w pojedynczej zmiennej (<em>univariate</em>), (2) obserwacje odstające w relacji między zmiennymi (<em>bivariate</em>), oraz (3) odstające obserwacje wielowymiarowo (<em>multivariate</em>).</p>
<section id="reguły-matematyczne-identyfikacji-odstających-univariate" class="level4 page-columns page-full" data-number="3.2.1.1">
<h4 data-number="3.2.1.1" class="anchored" data-anchor-id="reguły-matematyczne-identyfikacji-odstających-univariate"><span class="header-section-number">3.2.1.1</span> Reguły matematyczne identyfikacji odstających (<em>univariate</em>)</h4>
<p>Najczęściej stosuje się regułę IQR (Tukeya) oraz regułę opartą o standaryzację. W regule IQR wyznaczamy kwartyle <span class="math inline">\(Q_1\)</span> i <span class="math inline">\(Q_3\)</span> oraz rozstęp międzykwartylowy <span class="math inline">\(IQR = Q_3 - Q_1\)</span>. Obserwację <span class="math inline">\(x\)</span> uznaje się za odstającą, gdy:</p>
<p><span class="math display">\[
x &lt; Q_1 - 1.5\cdot IQR \quad \text{lub} \quad x &gt; Q_3 + 1.5\cdot IQR.
\]</span></p>
<p>Reguła standaryzacyjna używa <em>z-score</em>:</p>
<p><span class="math display">\[
z = \frac{x-\mu}{\sigma}.
\]</span></p>
<p>Typowo za odstające przyjmuje się obserwacje o <span class="math inline">\(|z| &gt; 3\)</span>, ale jest to reguła wrażliwa na odstające wartości, ponieważ <span class="math inline">\(\mu\)</span> i <span class="math inline">\(\sigma\)</span> same ulegają zniekształceniu. W danych skośnych (np. dochody) często lepsze są metody odporne.</p>
<p>Odporna standaryzacja opiera się na medianie i medianowym odchyleniu bezwzględnym MAD. Dla <span class="math inline">\(MAD = \mathrm{median}(|x - \mathrm{median}(x)|)\)</span> stosuje się tzw. odporny <em>z-score</em>:</p>
<p><span class="math display">\[
z_{\mathrm{rob}} = \frac{x-\mathrm{median}(x)}{1.4826\cdot MAD}.
\]</span></p>
<p>Współczynnik (1.4826 <a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>) skaluje MAD do odpowiednika odchylenia standardowego przy rozkładzie normalnym.</p>
<div class="no-row-height column-margin column-container"><div id="fn2"><p><sup>2</sup>&nbsp;Liczba 1.4826 pochodzi ze „skalowania” miary MAD tak, aby była porównywalna z odchyleniem standardowym przy rozkładzie normalnym. Dla rozkładu normalnego <span class="math inline">\(X \sim \mathcal N(\mu,\sigma)\)</span> zachodzi zależność <span class="math inline">\(MAD = \Phi^{-1}(0.75)\,\sigma \approx 0.6745,\sigma\)</span> bo dla <span class="math inline">\(Z\sim\mathcal N(0,1)\)</span> wartość <span class="math inline">\(\mathrm{median}(|Z|)\)</span> to dokładnie 75. percentyl rozkładu normalnego: <span class="math inline">\(\Phi^{-1}(0.75)\)</span>. Żeby z MAD zrobić estymator „w skali <span class="math inline">\(\sigma\)</span>”, mnoży się przez odwrotność tej stałej <span class="math inline">\(\sigma \approx \frac{MAD}{0.6745} \approx 1.4826 \cdot MAD\)</span> i stąd bierze się 1.4826 (dokładniej <span class="math inline">\(1 / \Phi^{-1}(0.75)\)</span>).</p></div></div><p>W naszych danych sensownymi kandydatami do analizy odstających są: <code>income_eur</code>, <code>avg_basket_eur</code>, <code>visits_last30</code>, a także „błędy logiczne” w <code>age</code> i <code>returns_last90</code>.</p>
<div id="d9e0e45e" class="cell" data-execution_count="16">
<details open="" class="code-fold">
<summary>Kod</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>num_cols <span class="op">=</span> [<span class="st">"age"</span>, <span class="st">"income_eur"</span>, <span class="st">"visits_last30"</span>, <span class="st">"avg_basket_eur"</span>, <span class="st">"returns_last90"</span>, <span class="st">"satisfaction_1_5"</span>]</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Szybka diagnostyka: podstawowe statystyki + percentyle</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>df[num_cols].describe(percentiles<span class="op">=</span>[<span class="fl">0.01</span>, <span class="fl">0.05</span>, <span class="fl">0.95</span>, <span class="fl">0.99</span>]).T</span></code></pre></div><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="15">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">count</th>
<th data-quarto-table-cell-role="th">mean</th>
<th data-quarto-table-cell-role="th">std</th>
<th data-quarto-table-cell-role="th">min</th>
<th data-quarto-table-cell-role="th">1%</th>
<th data-quarto-table-cell-role="th">5%</th>
<th data-quarto-table-cell-role="th">50%</th>
<th data-quarto-table-cell-role="th">95%</th>
<th data-quarto-table-cell-role="th">99%</th>
<th data-quarto-table-cell-role="th">max</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">age</th>
<td>333.0</td>
<td>38.207207</td>
<td>14.428125</td>
<td>5.00</td>
<td>16.0000</td>
<td>16.6000</td>
<td>38.000</td>
<td>58.4000</td>
<td>69.0000</td>
<td>120.0</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">income_eur</th>
<td>317.0</td>
<td>40776.328076</td>
<td>44393.786000</td>
<td>4302.00</td>
<td>8218.6800</td>
<td>11883.6000</td>
<td>32632.000</td>
<td>83047.6000</td>
<td>177796.6000</td>
<td>490032.0</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">visits_last30</th>
<td>350.0</td>
<td>6.045714</td>
<td>2.714320</td>
<td>0.00</td>
<td>1.0000</td>
<td>2.0000</td>
<td>6.000</td>
<td>11.0000</td>
<td>13.0000</td>
<td>24.0</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">avg_basket_eur</th>
<td>332.0</td>
<td>52.835060</td>
<td>48.248423</td>
<td>16.05</td>
<td>18.0016</td>
<td>20.9775</td>
<td>43.835</td>
<td>99.6435</td>
<td>150.4721</td>
<td>668.8</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">returns_last90</th>
<td>350.0</td>
<td>0.777143</td>
<td>0.880572</td>
<td>-1.00</td>
<td>0.0000</td>
<td>0.0000</td>
<td>1.000</td>
<td>3.0000</td>
<td>3.0000</td>
<td>4.0</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">satisfaction_1_5</th>
<td>327.0</td>
<td>3.645260</td>
<td>0.887628</td>
<td>1.00</td>
<td>1.0000</td>
<td>2.0000</td>
<td>4.000</td>
<td>5.0000</td>
<td>5.0000</td>
<td>5.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="reguła-iqr-dla-jednej-zmiennej" class="level4" data-number="3.2.1.2">
<h4 data-number="3.2.1.2" class="anchored" data-anchor-id="reguła-iqr-dla-jednej-zmiennej"><span class="header-section-number">3.2.1.2</span> Reguła IQR dla jednej zmiennej</h4>
<div id="e4cf97e4" class="cell" data-execution_count="17">
<details open="" class="code-fold">
<summary>Kod</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> iqr_outliers(s: pd.Series, k: <span class="bu">float</span> <span class="op">=</span> <span class="fl">1.5</span>):</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>    s <span class="op">=</span> s.dropna()</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    q1, q3 <span class="op">=</span> s.quantile(<span class="fl">0.25</span>), s.quantile(<span class="fl">0.75</span>)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    iqr <span class="op">=</span> q3 <span class="op">-</span> q1</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    lower, upper <span class="op">=</span> q1 <span class="op">-</span> k <span class="op">*</span> iqr, q3 <span class="op">+</span> k <span class="op">*</span> iqr</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> lower, upper</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>lower_inc, upper_inc <span class="op">=</span> iqr_outliers(df[<span class="st">"income_eur"</span>])</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>out_income <span class="op">=</span> df[(df[<span class="st">"income_eur"</span>] <span class="op">&lt;</span> lower_inc) <span class="op">|</span> (df[<span class="st">"income_eur"</span>] <span class="op">&gt;</span> upper_inc)]</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>out_income[[<span class="st">"customer_id"</span>, <span class="st">"income_eur"</span>, <span class="st">"city"</span>, <span class="st">"segment"</span>]].head(<span class="dv">10</span>)</span></code></pre></div><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="16">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">customer_id</th>
<th data-quarto-table-cell-role="th">income_eur</th>
<th data-quarto-table-cell-role="th">city</th>
<th data-quarto-table-cell-role="th">segment</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">39</th>
<td>100039</td>
<td>485953.0</td>
<td>Łódź</td>
<td>VIP</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">55</th>
<td>100055</td>
<td>146032.0</td>
<td>Łódź</td>
<td>B2C</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">59</th>
<td>100059</td>
<td>86006.0</td>
<td>Wrocław</td>
<td>VIP</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">66</th>
<td>100066</td>
<td>98746.0</td>
<td>Wrocław</td>
<td>Student</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">67</th>
<td>100067</td>
<td>85420.0</td>
<td>Wrocław</td>
<td>B2C</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">82</th>
<td>100082</td>
<td>80700.0</td>
<td>Lublin</td>
<td>B2C</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">83</th>
<td>100083</td>
<td>82821.0</td>
<td>None</td>
<td>B2C</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">94</th>
<td>100094</td>
<td>490032.0</td>
<td>Lublin</td>
<td>B2C</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">95</th>
<td>100095</td>
<td>86004.0</td>
<td>Poznań</td>
<td>B2B</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">151</th>
<td>100151</td>
<td>87909.0</td>
<td>Wrocław</td>
<td>B2C</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="odporny-z-score-mad" class="level4" data-number="3.2.1.3">
<h4 data-number="3.2.1.3" class="anchored" data-anchor-id="odporny-z-score-mad"><span class="header-section-number">3.2.1.3</span> Odporny z-score (MAD)</h4>
<div id="cbacd694" class="cell" data-execution_count="18">
<details open="" class="code-fold">
<summary>Kod</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> robust_zscore(s: pd.Series):</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>    s <span class="op">=</span> s.astype(<span class="bu">float</span>)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    med <span class="op">=</span> np.nanmedian(s)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    mad <span class="op">=</span> np.nanmedian(np.<span class="bu">abs</span>(s <span class="op">-</span> med))</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (s <span class="op">-</span> med) <span class="op">/</span> (<span class="fl">1.4826</span> <span class="op">*</span> mad)</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"income_robust_z"</span>] <span class="op">=</span> robust_zscore(df[<span class="st">"income_eur"</span>])</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>df.loc[df[<span class="st">"income_robust_z"</span>].<span class="bu">abs</span>() <span class="op">&gt;</span> <span class="dv">3</span>, [<span class="st">"customer_id"</span>, <span class="st">"income_eur"</span>, <span class="st">"income_robust_z"</span>]].head(<span class="dv">10</span>)</span></code></pre></div><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="17">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">customer_id</th>
<th data-quarto-table-cell-role="th">income_eur</th>
<th data-quarto-table-cell-role="th">income_robust_z</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">39</th>
<td>100039</td>
<td>485953.0</td>
<td>26.659763</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">55</th>
<td>100055</td>
<td>146032.0</td>
<td>6.669043</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">59</th>
<td>100059</td>
<td>86006.0</td>
<td>3.138920</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">66</th>
<td>100066</td>
<td>98746.0</td>
<td>3.888158</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">67</th>
<td>100067</td>
<td>85420.0</td>
<td>3.104457</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">94</th>
<td>100094</td>
<td>490032.0</td>
<td>26.899649</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">95</th>
<td>100095</td>
<td>86004.0</td>
<td>3.138802</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">151</th>
<td>100151</td>
<td>87909.0</td>
<td>3.250835</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">153</th>
<td>100153</td>
<td>91242.0</td>
<td>3.446848</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">155</th>
<td>100155</td>
<td>83954.0</td>
<td>3.018242</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="odstające-jako-błąd-jakości-danych" class="level4" data-number="3.2.1.4">
<h4 data-number="3.2.1.4" class="anchored" data-anchor-id="odstające-jako-błąd-jakości-danych"><span class="header-section-number">3.2.1.4</span> „Odstające” jako błąd jakości danych</h4>
<p>Część wartości odstających to nie „rzadkie przypadki”, tylko po prostu błędne dane. W <code>data.csv</code> celowo pojawiają się np. wiek 5 i 120 oraz ujemna liczba zwrotów (<code>returns_last90 == -1</code>). To nie są outliery w sensie rozkładu, tylko naruszenia dziedziny wartości.</p>
<p>W EDA warto wprost zdefiniować reguły walidacji, np.: <span class="math inline">\(16 \leq \text{age} \leq 80,\)</span> <span class="math inline">\(\text{returns\_last90} \geq 0.\)</span></p>
<p>W Pythonie:</p>
<div id="8fc7f76e" class="cell" data-execution_count="19">
<details open="" class="code-fold">
<summary>Kod</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>bad_age <span class="op">=</span> df[(df[<span class="st">"age"</span>] <span class="op">&lt;</span> <span class="dv">16</span>) <span class="op">|</span> (df[<span class="st">"age"</span>] <span class="op">&gt;</span> <span class="dv">80</span>)]</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>bad_returns <span class="op">=</span> df[df[<span class="st">"returns_last90"</span>] <span class="op">&lt;</span> <span class="dv">0</span>]</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>bad_age[[<span class="st">"customer_id"</span>,<span class="st">"age"</span>]].head(), bad_returns[[<span class="st">"customer_id"</span>,<span class="st">"returns_last90"</span>]].head()</span></code></pre></div><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="18">
<pre><code>(     customer_id    age
 43        100043  120.0
 105       100105  120.0
 144       100144    5.0
 250       100250    5.0
 340       100340  120.0,
      customer_id  returns_last90
 5         100005              -1
 93        100093              -1
 203       100203              -1)</code></pre>
</div>
</div>
<p>Takie przypadki najczęściej traktuje się jako: (1) poprawa na podstawie źródła (jeśli możliwa), albo (2) ustawienie na brak (<code>NaN</code>) i późniejsza imputacja, albo (3) usunięcie obserwacji (jeżeli jest ich mało i są ewidentnie błędne).</p>
</section>
<section id="co-robimy-z-obserwacjami-odstającymi-w-eda-i-ml" class="level4" data-number="3.2.1.5">
<h4 data-number="3.2.1.5" class="anchored" data-anchor-id="co-robimy-z-obserwacjami-odstającymi-w-eda-i-ml"><span class="header-section-number">3.2.1.5</span> Co robimy z obserwacjami odstającymi w EDA i ML</h4>
<p>W EDA celem jest zrozumienie przyczyny i konsekwencji odstających wartości. Zwykle robimy trzy rzeczy: po pierwsze, oceniamy skalę zjawiska (ile obserwacji, w których zmiennych), po drugie, sprawdzamy czy są to błędy (np. wartości niemożliwe), a po trzecie, analizujemy wpływ na wnioski (np. średnie, korelacje, wykresy). Warto pamiętać, że średnia i odchylenie standardowe są wrażliwe, dlatego do EDA często stosuje się medianę i IQR.</p>
<p>W ML decyzja zależy od modelu i celu. Dla modeli liniowych i dyskryminacyjnych (np. regresja logistyczna, LDA/QDA) odstające wartości mogą znacząco zaburzyć dopasowanie, dlatego typowe strategie to: transformacje (np. <span class="math inline">\(\log\)</span> dla <code>income_eur</code>), winsoryzacja/obcięcie ogonów, zastosowanie skalowania odpornego (np. <code>RobustScaler</code>), albo świadome usunięcie obserwacji błędnych. Dla drzew i ich zespołów (<em>Random Forest, boosting</em>) pojedyncze ekstremalne wartości często są mniej groźne, ale nadal mogą wpływać na podziały lub na stabilność w małych próbkach. Dla metod odległościowych i SVM skalowanie jest kluczowe: outliery w skali potrafią zdominować metrykę lub margines.</p>
<p>Najczęściej spotykane „operacyjne” podejścia to:</p>
<ul>
<li><strong>transformacja rozkładu</strong> (np. <span class="math inline">\(\log\)</span>, Box–Cox/Yeo–Johnson),</li>
<li><strong>winsoryzacja</strong>: obcięcie do percentyli (np. 1%–99%),</li>
<li><strong>flaga odstających</strong> jako dodatkowa cecha (model uczy się, że to przypadek nietypowy),</li>
<li><strong>usunięcie</strong> tylko wtedy, gdy jest to błąd lub obserwacja spoza domeny problemu.</li>
</ul>
<p>Przykład winsoryzacji (percentyle) dla <code>income_eur</code>:</p>
<div id="f7b0c0e9" class="cell" data-execution_count="20">
<details open="" class="code-fold">
<summary>Kod</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>p01, p99 <span class="op">=</span> df[<span class="st">"income_eur"</span>].quantile([<span class="fl">0.01</span>, <span class="fl">0.99</span>])</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"income_eur_capped"</span>] <span class="op">=</span> df[<span class="st">"income_eur"</span>].clip(lower<span class="op">=</span>p01, upper<span class="op">=</span>p99)</span></code></pre></div><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section>
</section>
<section id="braki-danych-i-imputacja" class="level3" data-number="3.2.2">
<h3 data-number="3.2.2" class="anchored" data-anchor-id="braki-danych-i-imputacja"><span class="header-section-number">3.2.2</span> Braki danych i imputacja</h3>
<p>Braki danych (<em>missing values</em>) mogą wynikać z problemów pomiaru, integracji źródeł, błędów ETL, ale także z „logiki procesu” (np. klient nie ma ocen satysfakcji, bo nie wypełnił ankiety). W EDA kluczowe jest rozpoznanie: (1) gdzie braki występują, (2) ile ich jest, (3) czy są zależne od innych zmiennych (braki „systematyczne”). W ML brak danych wymaga decyzji, ponieważ większość klasycznych modeli nie obsługuje <code>NaN</code> wprost.</p>
<p>Na początek warto policzyć braki:</p>
<div id="eac95020" class="cell" data-execution_count="21">
<details open="" class="code-fold">
<summary>Kod</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>na_counts <span class="op">=</span> df.isna().<span class="bu">sum</span>().sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>na_share <span class="op">=</span> (df.isna().mean().sort_values(ascending<span class="op">=</span><span class="va">False</span>) <span class="op">*</span> <span class="dv">100</span>).<span class="bu">round</span>(<span class="dv">2</span>)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>pd.DataFrame({<span class="st">"missing_count"</span>: na_counts, <span class="st">"missing_%"</span>: na_share})</span></code></pre></div><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="20">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">missing_count</th>
<th data-quarto-table-cell-role="th">missing_%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">income_eur_capped</th>
<td>33</td>
<td>9.43</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">income_robust_z</th>
<td>33</td>
<td>9.43</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">income_eur</th>
<td>33</td>
<td>9.43</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">satisfaction_1_5</th>
<td>23</td>
<td>6.57</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">device_type</th>
<td>21</td>
<td>6.00</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">avg_basket_eur</th>
<td>18</td>
<td>5.14</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">age</th>
<td>17</td>
<td>4.86</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">city</th>
<td>17</td>
<td>4.86</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">notes</th>
<td>16</td>
<td>4.57</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">has_promo</th>
<td>0</td>
<td>0.00</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">churned</th>
<td>0</td>
<td>0.00</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">customer_id</th>
<td>0</td>
<td>0.00</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">returns_last90</th>
<td>0</td>
<td>0.00</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">signup_date</th>
<td>0</td>
<td>0.00</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">segment</th>
<td>0</td>
<td>0.00</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">last_purchase_date</th>
<td>0</td>
<td>0.00</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">visits_last30</th>
<td>0</td>
<td>0.00</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<section id="co-robimy-z-brakami-w-eda-i-ml" class="level4" data-number="3.2.2.1">
<h4 data-number="3.2.2.1" class="anchored" data-anchor-id="co-robimy-z-brakami-w-eda-i-ml"><span class="header-section-number">3.2.2.1</span> Co robimy z brakami w EDA i ML</h4>
<p>W EDA braki traktujemy jako informację o jakości danych i procesie ich powstawania. Sprawdzamy, czy braki są losowe, czy dotyczą specyficznych segmentów (np. brak <code>income_eur</code> tylko dla jednego segmentu), oraz czy ich usunięcie nie zmieni populacji (<em>bias</em>). W ML trzeba z kolei zadbać o to, aby imputacja była wykonywana bez wycieku informacji: parametry imputacji wyznaczamy na zbiorze treningowym i stosujemy do walidacyjnego/testowego.</p>
<p>Decyzje praktyczne obejmują: usuwanie cech/wierszy (gdy braków jest bardzo dużo), imputację prostą (średnia/mediana/moda), imputację warunkową (np. mediana w grupach), metody oparte na podobieństwie (k-NN), metody iteracyjne (MICE), a także dodawanie wskaźników braków (<em>missing indicators</em>), które pozwalają modelowi uczyć się samego faktu braku jako sygnału.</p>
</section>
<section id="metody-imputacji" class="level4" data-number="3.2.2.2">
<h4 data-number="3.2.2.2" class="anchored" data-anchor-id="metody-imputacji"><span class="header-section-number">3.2.2.2</span> Metody imputacji</h4>
<ol type="1">
<li>Imputacja stałą lub modą (kategorie i zmienne dyskretne)</li>
</ol>
<p>Dla zmiennych kategorycznych często stosuje się modę lub specjalną kategorię ‘missing’. Dlaczego to bywa dobre? Ponieważ w wielu danych fakt, że czegoś brakuje, jest informacją samą w sobie. Na przykład: brak miasta może oznaczać, że klient nie podał danych adresowych, co może korelować z innymi cechami lub nawet z <code>churned</code>. Jeśli zamienimy brak na osobną kategorię “missing”, model może się tego „nauczyć”.</p>
<div id="cbaa7181" class="cell" data-execution_count="22">
<details open="" class="code-fold">
<summary>Kod</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"city"</span>] <span class="op">=</span> df[<span class="st">"city"</span>].fillna(<span class="st">"missing"</span>)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"device_type"</span>] <span class="op">=</span> df[<span class="st">"device_type"</span>].fillna(<span class="st">"missing"</span>)</span></code></pre></div><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<ol start="2" type="1">
<li>Imputacja medianą/średnią (zmienne liczbowe)</li>
</ol>
<p>Jest to metoda szybka, ale ignoruje zależności między cechami:</p>
<div id="65ba5d98" class="cell" data-execution_count="23">
<details open="" class="code-fold">
<summary>Kod</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"income_eur"</span>] <span class="op">=</span> df[<span class="st">"income_eur"</span>].fillna(df[<span class="st">"income_eur"</span>].median())</span></code></pre></div><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<ol start="3" type="1">
<li>Imputacja grupowa (warunkowa)</li>
</ol>
<p>Bardzo użyteczna, gdy rozkłady różnią się w segmentach, np. dochody w segmentach <code>VIP</code> vs <code>Student</code>:</p>
<div id="fb90eb41" class="cell" data-execution_count="24">
<details open="" class="code-fold">
<summary>Kod</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"income_eur"</span>] <span class="op">=</span> df[<span class="st">"income_eur"</span>].fillna(</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>    df.groupby(<span class="st">"segment"</span>)[<span class="st">"income_eur"</span>].transform(<span class="st">"median"</span>)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<ol start="4" type="1">
<li>k-NN Imputer (podobieństwo obserwacji)</li>
</ol>
<p>Wykorzystuje sąsiadów w przestrzeni cech do uzupełniania braków. Wymaga skalowania i pracy na liczbach.</p>
<div id="75369d33" class="cell" data-execution_count="25">
<details open="" class="code-fold">
<summary>Kod</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.impute <span class="im">import</span> KNNImputer</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>num_features <span class="op">=</span> [<span class="st">"age"</span>, <span class="st">"income_eur"</span>, <span class="st">"visits_last30"</span>, <span class="st">"avg_basket_eur"</span>, <span class="st">"returns_last90"</span>, <span class="st">"satisfaction_1_5"</span>]</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>imputer <span class="op">=</span> KNNImputer(n_neighbors<span class="op">=</span><span class="dv">5</span>, weights<span class="op">=</span><span class="st">"distance"</span>) <span class="co"># obserwacje imputujące będą ważone odległością</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>df[num_features] <span class="op">=</span> imputer.fit_transform(df[num_features])</span></code></pre></div><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<ol start="5" type="1">
<li><em>Iterative Imputer</em> (MICE – imputacja modelowa)</li>
</ol>
<p>Uzupełnia jedną zmienną na podstawie pozostałych (iteracyjnie), co lepiej zachowuje relacje w danych. Domyślną opcją <code>IterativeImputer</code> jest regresja liniowa z regularyzacją typu ridge w ujęciu bayesowskim (<code>sklearn.linear_model.BayesianRidge</code>). Można jednak wybrać inne techniki jako model uzupelniający</p>
<div id="1bcfe641" class="cell" data-execution_count="26">
<details open="" class="code-fold">
<summary>Kod</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestRegressor</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>imp <span class="op">=</span> IterativeImputer(estimator<span class="op">=</span>RandomForestRegressor(n_estimators<span class="op">=</span><span class="dv">200</span>, random_state<span class="op">=</span><span class="dv">42</span>))</span></code></pre></div><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div id="fd21134c" class="cell" data-execution_count="27">
<details open="" class="code-fold">
<summary>Kod</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.experimental <span class="im">import</span> enable_iterative_imputer  <span class="co"># noqa: F401</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.impute <span class="im">import</span> IterativeImputer</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>imp <span class="op">=</span> IterativeImputer(random_state<span class="op">=</span><span class="dv">42</span>, max_iter<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>df[num_features] <span class="op">=</span> imp.fit_transform(df[num_features])</span></code></pre></div><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<ol start="6" type="1">
<li>Wskaźniki braków jako cechy</li>
</ol>
<p>Czasem sam fakt braku jest informacyjny (np. brak satysfakcji może korelować z churn). Można dodać flagi:</p>
<div id="468e2845" class="cell" data-execution_count="28">
<details open="" class="code-fold">
<summary>Kod</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ponieważ wcześniej zmienna income_eur była zastępowana medianami to poniższy kod da same 0 dla income_missing. Podobnie dla zmiennej satisfaction_1_5</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"income_missing"</span>] <span class="op">=</span> df[<span class="st">"income_eur"</span>].isna().astype(<span class="bu">int</span>)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"satisfaction_missing"</span>] <span class="op">=</span> df[<span class="st">"satisfaction_1_5"</span>].isna().astype(<span class="bu">int</span>)</span></code></pre></div><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<p>W praktyce (szczególnie w ML) flagi braków często działają dobrze w połączeniu z imputacją, bo pozwalają modelowi rozróżnić „wartość prawdziwą” od „wartości wstawionej”.</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Ostrzeżenie
</div>
</div>
<div class="callout-body-container callout-body">
<p>W modelowaniu nie imputujemy „ręcznie na całym df”, tylko budujemy potok, który dopasowuje imputery na treningu, a potem stosuje na walidacji/teście:</p>
<div id="42f885bc" class="cell" data-execution_count="29">
<details open="" class="code-fold">
<summary>Kod</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.compose <span class="im">import</span> ColumnTransformer</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> OneHotEncoder</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.pipeline <span class="im">import</span> Pipeline</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.impute <span class="im">import</span> SimpleImputer</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LogisticRegression</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> df.drop(columns<span class="op">=</span>[<span class="st">"churned"</span>])</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> df[<span class="st">"churned"</span>]</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Uwaga: pandas może trzymać braki jako `pd.NA` (np. typy StringDtype/boolean).</span></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a><span class="co"># scikit-learn oczekuje braków jako `np.nan` i potrafi się wysypać na `pd.NA`.</span></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> X.replace({pd.NA: np.nan})</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X, y, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state<span class="op">=</span><span class="dv">42</span>, stratify<span class="op">=</span>y)</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>num_cols <span class="op">=</span> [<span class="st">"age"</span>, <span class="st">"income_eur"</span>, <span class="st">"visits_last30"</span>, <span class="st">"avg_basket_eur"</span>, <span class="st">"returns_last90"</span>, <span class="st">"satisfaction_1_5"</span>]</span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>cat_cols <span class="op">=</span> [<span class="st">"city"</span>, <span class="st">"segment"</span>, <span class="st">"device_type"</span>, <span class="st">"has_promo"</span>, <span class="st">"notes"</span>]</span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a><span class="co"># (opcjonalnie) upewniamy się, że kategorie są zwykłym `object`, a nie np. `string[python]` z `pd.NA`</span></span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>X_train[cat_cols] <span class="op">=</span> X_train[cat_cols].astype(<span class="st">"object"</span>)</span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>X_test[cat_cols] <span class="op">=</span> X_test[cat_cols].astype(<span class="st">"object"</span>)</span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a>preprocess <span class="op">=</span> ColumnTransformer(</span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a>    transformers<span class="op">=</span>[</span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a>        (<span class="st">"num"</span>, Pipeline(steps<span class="op">=</span>[</span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a>            (<span class="st">"imputer"</span>, SimpleImputer(strategy<span class="op">=</span><span class="st">"median"</span>))</span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a>        ]), num_cols),</span>
<span id="cb34-29"><a href="#cb34-29" aria-hidden="true" tabindex="-1"></a>        (<span class="st">"cat"</span>, Pipeline(steps<span class="op">=</span>[</span>
<span id="cb34-30"><a href="#cb34-30" aria-hidden="true" tabindex="-1"></a>            (<span class="st">"imputer"</span>, SimpleImputer(strategy<span class="op">=</span><span class="st">"most_frequent"</span>)),</span>
<span id="cb34-31"><a href="#cb34-31" aria-hidden="true" tabindex="-1"></a>            (<span class="st">"onehot"</span>, OneHotEncoder(handle_unknown<span class="op">=</span><span class="st">"ignore"</span>))</span>
<span id="cb34-32"><a href="#cb34-32" aria-hidden="true" tabindex="-1"></a>        ]), cat_cols),</span>
<span id="cb34-33"><a href="#cb34-33" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb34-34"><a href="#cb34-34" aria-hidden="true" tabindex="-1"></a>    remainder<span class="op">=</span><span class="st">"drop"</span></span>
<span id="cb34-35"><a href="#cb34-35" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb34-36"><a href="#cb34-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-37"><a href="#cb34-37" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> Pipeline(steps<span class="op">=</span>[</span>
<span id="cb34-38"><a href="#cb34-38" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"prep"</span>, preprocess),</span>
<span id="cb34-39"><a href="#cb34-39" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"clf"</span>, LogisticRegression(max_iter<span class="op">=</span><span class="dv">200</span>))</span>
<span id="cb34-40"><a href="#cb34-40" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb34-41"><a href="#cb34-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-42"><a href="#cb34-42" aria-hidden="true" tabindex="-1"></a>model.fit(X_train, y_train)</span></code></pre></div><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="27">
<style>#sk-container-id-1 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: black;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-1 {
  color: var(--sklearn-color-text);
}

#sk-container-id-1 pre {
  padding: 0;
}

#sk-container-id-1 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-1 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-1 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-1 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-1 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-1 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-1 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-1 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-1 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-1 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-1 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-1 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-1 label.sk-toggleable__label {
  cursor: pointer;
  display: block;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
}

#sk-container-id-1 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-1 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-1 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-1 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-1 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-1 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-1 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-1 div.sk-label label.sk-toggleable__label,
#sk-container-id-1 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-1 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-1 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-1 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-1 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-1 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-1 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 1ex;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-1 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-1 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-1 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-1 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div id="sk-container-id-1" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>Pipeline(steps=[('prep',
                 ColumnTransformer(transformers=[('num',
                                                  Pipeline(steps=[('imputer',
                                                                   SimpleImputer(strategy='median'))]),
                                                  ['age', 'income_eur',
                                                   'visits_last30',
                                                   'avg_basket_eur',
                                                   'returns_last90',
                                                   'satisfaction_1_5']),
                                                 ('cat',
                                                  Pipeline(steps=[('imputer',
                                                                   SimpleImputer(strategy='most_frequent')),
                                                                  ('onehot',
                                                                   OneHotEncoder(handle_unknown='ignore'))]),
                                                  ['city', 'segment',
                                                   'device_type', 'has_promo',
                                                   'notes'])])),
                ('clf', LogisticRegression(max_iter=200))])</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-1" type="checkbox"><label for="sk-estimator-id-1" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;&nbsp;Pipeline<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.5/modules/generated/sklearn.pipeline.Pipeline.html">?<span>Documentation for Pipeline</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></label><div class="sk-toggleable__content fitted"><pre>Pipeline(steps=[('prep',
                 ColumnTransformer(transformers=[('num',
                                                  Pipeline(steps=[('imputer',
                                                                   SimpleImputer(strategy='median'))]),
                                                  ['age', 'income_eur',
                                                   'visits_last30',
                                                   'avg_basket_eur',
                                                   'returns_last90',
                                                   'satisfaction_1_5']),
                                                 ('cat',
                                                  Pipeline(steps=[('imputer',
                                                                   SimpleImputer(strategy='most_frequent')),
                                                                  ('onehot',
                                                                   OneHotEncoder(handle_unknown='ignore'))]),
                                                  ['city', 'segment',
                                                   'device_type', 'has_promo',
                                                   'notes'])])),
                ('clf', LogisticRegression(max_iter=200))])</pre></div> </div></div><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-2" type="checkbox"><label for="sk-estimator-id-2" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;prep: ColumnTransformer<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.5/modules/generated/sklearn.compose.ColumnTransformer.html">?<span>Documentation for prep: ColumnTransformer</span></a></label><div class="sk-toggleable__content fitted"><pre>ColumnTransformer(transformers=[('num',
                                 Pipeline(steps=[('imputer',
                                                  SimpleImputer(strategy='median'))]),
                                 ['age', 'income_eur', 'visits_last30',
                                  'avg_basket_eur', 'returns_last90',
                                  'satisfaction_1_5']),
                                ('cat',
                                 Pipeline(steps=[('imputer',
                                                  SimpleImputer(strategy='most_frequent')),
                                                 ('onehot',
                                                  OneHotEncoder(handle_unknown='ignore'))]),
                                 ['city', 'segment', 'device_type', 'has_promo',
                                  'notes'])])</pre></div> </div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-3" type="checkbox"><label for="sk-estimator-id-3" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">num</label><div class="sk-toggleable__content fitted"><pre>['age', 'income_eur', 'visits_last30', 'avg_basket_eur', 'returns_last90', 'satisfaction_1_5']</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-4" type="checkbox"><label for="sk-estimator-id-4" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;SimpleImputer<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.5/modules/generated/sklearn.impute.SimpleImputer.html">?<span>Documentation for SimpleImputer</span></a></label><div class="sk-toggleable__content fitted"><pre>SimpleImputer(strategy='median')</pre></div> </div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-5" type="checkbox"><label for="sk-estimator-id-5" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">cat</label><div class="sk-toggleable__content fitted"><pre>['city', 'segment', 'device_type', 'has_promo', 'notes']</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-6" type="checkbox"><label for="sk-estimator-id-6" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;SimpleImputer<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.5/modules/generated/sklearn.impute.SimpleImputer.html">?<span>Documentation for SimpleImputer</span></a></label><div class="sk-toggleable__content fitted"><pre>SimpleImputer(strategy='most_frequent')</pre></div> </div></div><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-7" type="checkbox"><label for="sk-estimator-id-7" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;OneHotEncoder<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.5/modules/generated/sklearn.preprocessing.OneHotEncoder.html">?<span>Documentation for OneHotEncoder</span></a></label><div class="sk-toggleable__content fitted"><pre>OneHotEncoder(handle_unknown='ignore')</pre></div> </div></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-8" type="checkbox"><label for="sk-estimator-id-8" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;LogisticRegression<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.5/modules/generated/sklearn.linear_model.LogisticRegression.html">?<span>Documentation for LogisticRegression</span></a></label><div class="sk-toggleable__content fitted"><pre>LogisticRegression(max_iter=200)</pre></div> </div></div></div></div></div></div>
</div>
</div>
<p>To podejście jest spójne z „dobrą praktyką” w ML: wszystkie transformacje uczące się parametrów (imputacja, skalowanie, kodowanie) są częścią pipeline i nie „podglądają” testu.</p>
</div>
</div>
</section>
</section>
</section>
<section id="eda-i-preprocessing-danych" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="eda-i-preprocessing-danych"><span class="header-section-number">3.3</span> EDA i preprocessing danych</h2>
<p>Ten rozdział porządkuje praktyczny przebieg pracy „od surowego pliku do macierzy cech gotowej dla modelu”. Najpierw wykonujemy EDA (ang. <em>exploratory data analysis</em>), aby zrozumieć dane (struktura, rozkłady, zależności, potencjalne problemy jakościowe), a dopiero potem przechodzimy do preprocessingu, który ma zapewnić poprawne działanie modeli i powtarzalność całego procesu. Kwestie braków danych i obserwacji odstających są tu jedynie sygnalizowane (szczegółowe strategie były w osobnych podrozdziałach).</p>
<section id="szybki-sanity-check-po-imporcie" class="level3" data-number="3.3.1">
<h3 data-number="3.3.1" class="anchored" data-anchor-id="szybki-sanity-check-po-imporcie"><span class="header-section-number">3.3.1</span> Szybki „sanity check” po imporcie</h3>
<p>Po wczytaniu danych pierwszym krokiem jest szybka kontrola struktury: rozmiar zbioru, typy kolumn, podstawowe podsumowania i liczba braków. W tym momencie warto również ujednolicić nazwy kolumn (np. <em>snake_case</em>), aby dalszy kod był czytelny i odporny na błędy.</p>
<div id="35c58a51" class="cell" data-execution_count="30">
<details open="" class="code-fold">
<summary>Kod</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"data.csv"</span>,</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>    na_values<span class="op">=</span>[<span class="st">""</span>, <span class="st">"NA"</span>, <span class="st">"N/A"</span>, <span class="st">"null"</span>, <span class="st">"None"</span>],</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    parse_dates<span class="op">=</span>[<span class="st">"signup_date"</span>, <span class="st">"last_purchase_date"</span>],</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    encoding<span class="op">=</span><span class="st">"utf-8"</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>df.shape</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>df.info()</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>df.head()</span></code></pre></div><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 350 entries, 0 to 349
Data columns (total 15 columns):
 #   Column              Non-Null Count  Dtype         
---  ------              --------------  -----         
 0   customer_id         350 non-null    int64         
 1   signup_date         350 non-null    datetime64[ns]
 2   last_purchase_date  350 non-null    datetime64[ns]
 3   age                 333 non-null    float64       
 4   income_eur          317 non-null    float64       
 5   city                333 non-null    object        
 6   segment             350 non-null    object        
 7   device_type         329 non-null    object        
 8   visits_last30       350 non-null    float64       
 9   avg_basket_eur      332 non-null    float64       
 10  returns_last90      350 non-null    float64       
 11  has_promo           350 non-null    bool          
 12  satisfaction_1_5    327 non-null    float64       
 13  churned             350 non-null    int64         
 14  notes               334 non-null    object        
dtypes: bool(1), datetime64[ns](2), float64(6), int64(2), object(4)
memory usage: 38.8+ KB</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="28">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">customer_id</th>
<th data-quarto-table-cell-role="th">signup_date</th>
<th data-quarto-table-cell-role="th">last_purchase_date</th>
<th data-quarto-table-cell-role="th">age</th>
<th data-quarto-table-cell-role="th">income_eur</th>
<th data-quarto-table-cell-role="th">city</th>
<th data-quarto-table-cell-role="th">segment</th>
<th data-quarto-table-cell-role="th">device_type</th>
<th data-quarto-table-cell-role="th">visits_last30</th>
<th data-quarto-table-cell-role="th">avg_basket_eur</th>
<th data-quarto-table-cell-role="th">returns_last90</th>
<th data-quarto-table-cell-role="th">has_promo</th>
<th data-quarto-table-cell-role="th">satisfaction_1_5</th>
<th data-quarto-table-cell-role="th">churned</th>
<th data-quarto-table-cell-role="th">notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>100000</td>
<td>2022-04-08</td>
<td>2022-10-19</td>
<td>NaN</td>
<td>72955.0</td>
<td>Warszawa</td>
<td>B2B</td>
<td>desktop</td>
<td>8.0</td>
<td>39.88</td>
<td>1.0</td>
<td>False</td>
<td>4.0</td>
<td>0</td>
<td>klient powracający</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>100001</td>
<td>2024-04-27</td>
<td>2024-05-13</td>
<td>52.0</td>
<td>24863.0</td>
<td>Kraków</td>
<td>B2C</td>
<td>mobile</td>
<td>12.0</td>
<td>67.80</td>
<td>1.0</td>
<td>False</td>
<td>3.0</td>
<td>0</td>
<td>brak uwag</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>100002</td>
<td>2023-12-18</td>
<td>2024-04-05</td>
<td>NaN</td>
<td>25333.0</td>
<td>Wrocław</td>
<td>B2C</td>
<td>desktop</td>
<td>6.0</td>
<td>27.04</td>
<td>1.0</td>
<td>True</td>
<td>4.0</td>
<td>0</td>
<td>reklamacja</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>100003</td>
<td>2023-04-26</td>
<td>2023-10-01</td>
<td>16.0</td>
<td>NaN</td>
<td>Łódź</td>
<td>B2B</td>
<td>mobile</td>
<td>6.0</td>
<td>149.03</td>
<td>1.0</td>
<td>False</td>
<td>3.0</td>
<td>1</td>
<td>brak uwag</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>100004</td>
<td>2023-04-20</td>
<td>2024-04-07</td>
<td>42.0</td>
<td>27954.0</td>
<td>Warszawa</td>
<td>B2C</td>
<td>desktop</td>
<td>7.0</td>
<td>49.73</td>
<td>1.0</td>
<td>True</td>
<td>3.0</td>
<td>0</td>
<td>NaN</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="12096bf5" class="cell" data-execution_count="31">
<details open="" class="code-fold">
<summary>Kod</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># szybki przegląd braków</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>(df.isna().mean().sort_values(ascending<span class="op">=</span><span class="va">False</span>) <span class="op">*</span> <span class="dv">100</span>).<span class="bu">round</span>(<span class="dv">2</span>)</span></code></pre></div><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="29">
<pre><code>income_eur            9.43
satisfaction_1_5      6.57
device_type           6.00
avg_basket_eur        5.14
age                   4.86
city                  4.86
notes                 4.57
customer_id           0.00
signup_date           0.00
last_purchase_date    0.00
segment               0.00
visits_last30         0.00
returns_last90        0.00
has_promo             0.00
churned               0.00
dtype: float64</code></pre>
</div>
</div>
<p>Na tym etapie sprawdzamy też duplikaty oraz ewentualne naruszenia prostych reguł domenowych (np. ujemne wartości tam, gdzie nie powinny wystąpić). Jeśli widzimy ewidentne błędy, zazwyczaj oznaczamy je do późniejszej korekty, zamiast natychmiast usuwać dane „w ciemno”.</p>
<div id="6e88179a" class="cell" data-execution_count="32">
<details open="" class="code-fold">
<summary>Kod</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>df.duplicated().<span class="bu">sum</span>()</span></code></pre></div><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="30">
<pre><code>np.int64(0)</code></pre>
</div>
</div>
</section>
<section id="eda---rozkłady-i-struktura-zmiennych" class="level3" data-number="3.3.2">
<h3 data-number="3.3.2" class="anchored" data-anchor-id="eda---rozkłady-i-struktura-zmiennych"><span class="header-section-number">3.3.2</span> EDA - rozkłady i struktura zmiennych</h3>
<p>EDA zaczynamy od uporządkowania typów zmiennych: rozdzielenia zmiennych liczbowych i kategorycznych oraz rozpoznania, które kolumny są zmiennymi docelowymi, identyfikatorami lub metadanymi (np. daty). W naszym <code>data.csv</code> naturalnie wyróżniają się liczby (np. <code>income_eur</code>, <code>avg_basket_eur</code>), kategorie (np. <code>segment</code>, <code>city</code>) i daty.</p>
<div id="112472fd" class="cell" data-execution_count="33">
<details open="" class="code-fold">
<summary>Kod</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>num_cols <span class="op">=</span> df.select_dtypes(include<span class="op">=</span><span class="st">"number"</span>).columns.tolist()</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>cat_cols <span class="op">=</span> df.select_dtypes(include<span class="op">=</span>[<span class="st">"object"</span>, <span class="st">"string"</span>, <span class="st">"bool"</span>]).columns.tolist()</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>num_cols, cat_cols</span></code></pre></div><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="31">
<pre><code>(['customer_id',
  'age',
  'income_eur',
  'visits_last30',
  'avg_basket_eur',
  'returns_last90',
  'satisfaction_1_5',
  'churned'],
 ['city', 'segment', 'device_type', 'has_promo', 'notes'])</code></pre>
</div>
</div>
<p>W analizie rozkładów dla zmiennych liczbowych bardzo dobre są histogramy z nakładką gęstości oraz wykresy pudełkowe. Warto pamiętać, że część zmiennych może być skośna (np. dochody), więc czasem sensowne jest pokazanie wykresu w skali logarytmicznej.</p>
<div id="4184742c" class="cell" data-execution_count="34">
<details open="" class="code-fold">
<summary>Kod</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> univariate_view(series, title):</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>    fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">4</span>))</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>    gs <span class="op">=</span> fig.add_gridspec(<span class="dv">1</span>, <span class="dv">2</span>, width_ratios<span class="op">=</span>[<span class="dv">3</span>, <span class="dv">1</span>])</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>    ax1 <span class="op">=</span> fig.add_subplot(gs[<span class="dv">0</span>, <span class="dv">0</span>])</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>    ax1.hist(series.dropna(), bins<span class="op">=</span><span class="dv">30</span>)</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>    ax1.set_title(<span class="ss">f"Histogram: </span><span class="sc">{</span>title<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>    ax1.set_xlabel(title)</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>    ax1.set_ylabel(<span class="st">"Liczność"</span>)</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>    ax2 <span class="op">=</span> fig.add_subplot(gs[<span class="dv">0</span>, <span class="dv">1</span>])</span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>    ax2.boxplot(series.dropna(), vert<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>    ax2.set_title(<span class="st">"Boxplot"</span>)</span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>    ax2.set_xticks([])</span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a>univariate_view(df[<span class="st">"income_eur"</span>], <span class="st">"income_eur"</span>)</span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a>univariate_view(df[<span class="st">"avg_basket_eur"</span>], <span class="st">"avg_basket_eur"</span>)</span></code></pre></div><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="02-przygotowanie-danych_files/figure-html/cell-35-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img src="02-przygotowanie-danych_files/figure-html/cell-35-output-1.png" width="949" height="372" class="figure-img"></a></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="02-przygotowanie-danych_files/figure-html/cell-35-output-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2"><img src="02-przygotowanie-danych_files/figure-html/cell-35-output-2.png" width="949" height="372" class="figure-img"></a></p>
</figure>
</div>
</div>
</div>
<p>Dla zmiennych kategorycznych kluczowe jest porównanie częstości. Prosty wykres słupkowy umożliwia identyfikację rzadkich kategorii oraz niespójności kodowania (np. różne wielkości liter, dodatkowe spacje).</p>
<div id="2b64de12" class="cell" data-execution_count="35">
<details open="" class="code-fold">
<summary>Kod</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> top_categories(series, title, top<span class="op">=</span><span class="dv">10</span>):</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>    counts <span class="op">=</span> series.value_counts(dropna<span class="op">=</span><span class="va">False</span>).head(top)</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">4</span>))</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>    plt.bar(counts.index.astype(<span class="bu">str</span>), counts.values)</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="ss">f"Top </span><span class="sc">{</span>top<span class="sc">}</span><span class="ss"> kategorii: </span><span class="sc">{</span>title<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>    plt.xticks(rotation<span class="op">=</span><span class="dv">30</span>, ha<span class="op">=</span><span class="st">"right"</span>)</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">"Liczność"</span>)</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>top_categories(df[<span class="st">"segment"</span>], <span class="st">"segment"</span>)</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>top_categories(df[<span class="st">"device_type"</span>], <span class="st">"device_type"</span>)</span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>top_categories(df[<span class="st">"city"</span>], <span class="st">"city"</span>, top<span class="op">=</span><span class="dv">12</span>)</span></code></pre></div><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="02-przygotowanie-danych_files/figure-html/cell-36-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3"><img src="02-przygotowanie-danych_files/figure-html/cell-36-output-1.png" width="949" height="373" class="figure-img"></a></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="02-przygotowanie-danych_files/figure-html/cell-36-output-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4"><img src="02-przygotowanie-danych_files/figure-html/cell-36-output-2.png" width="949" height="373" class="figure-img"></a></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="02-przygotowanie-danych_files/figure-html/cell-36-output-3.png" class="lightbox" data-gallery="quarto-lightbox-gallery-5"><img src="02-przygotowanie-danych_files/figure-html/cell-36-output-3.png" width="949" height="374" class="figure-img"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="eda---zależności-między-zmiennymi" class="level3" data-number="3.3.3">
<h3 data-number="3.3.3" class="anchored" data-anchor-id="eda---zależności-między-zmiennymi"><span class="header-section-number">3.3.3</span> EDA - zależności między zmiennymi</h3>
<p>W celu odkrycia zależności pomiędzy cechami wykreślamy macierz korelacji.</p>
<div id="f71b5c78" class="cell" data-execution_count="36">
<details open="" class="code-fold">
<summary>Kod</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># macierz korelacji (numeryczne)</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>corr <span class="op">=</span> df[num_cols].corr(numeric_only<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>im <span class="op">=</span> ax.imshow(corr, aspect<span class="op">=</span><span class="st">"auto"</span>)</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>fig.colorbar(im, ax<span class="op">=</span>ax)</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>ax.set_xticks(<span class="bu">range</span>(<span class="bu">len</span>(corr.columns)))</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>ax.set_xticklabels(corr.columns, rotation<span class="op">=</span><span class="dv">30</span>, ha<span class="op">=</span><span class="st">"right"</span>)</span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>ax.set_yticks(<span class="bu">range</span>(<span class="bu">len</span>(corr.index)))</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>ax.set_yticklabels(corr.index)</span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">"Macierz korelacji (numeryczne)"</span>)</span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a><span class="co"># wartości korelacji w komórkach</span></span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(corr.shape[<span class="dv">0</span>]):</span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(corr.shape[<span class="dv">1</span>]):</span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a>        val <span class="op">=</span> corr.iloc[i, j]</span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a>        color <span class="op">=</span> <span class="st">"black"</span> <span class="cf">if</span> <span class="bu">abs</span>(val) <span class="op">&gt;=</span> <span class="fl">0.5</span> <span class="cf">else</span> <span class="st">"white"</span></span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a>        ax.text(j, i, <span class="ss">f"</span><span class="sc">{</span>val<span class="sc">:.2f}</span><span class="ss">"</span>, ha<span class="op">=</span><span class="st">"center"</span>, va<span class="op">=</span><span class="st">"center"</span>, color<span class="op">=</span>color, fontsize<span class="op">=</span><span class="dv">8</span>)</span>
<span id="cb45-20"><a href="#cb45-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-21"><a href="#cb45-21" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb45-22"><a href="#cb45-22" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="02-przygotowanie-danych_files/figure-html/cell-37-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-6"><img src="02-przygotowanie-danych_files/figure-html/cell-37-output-1.png" width="719" height="566" class="figure-img"></a></p>
</figure>
</div>
</div>
</div>
<p>W kontekście klasyfikacji warto też zobaczyć, jak rozkłady cech różnią się między klasami (tu: <code>churned</code>). Bardzo czytelny jest wykres pudełkowy/wiolinowy „cecha vs klasa” albo porównanie histogramów. Poniżej przykład boxplotu cechy w podziale na <code>churned</code>.</p>
<div id="57498922" class="cell" data-execution_count="37">
<details open="" class="code-fold">
<summary>Kod</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> box_by_target(df, feature, target<span class="op">=</span><span class="st">"churned"</span>):</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>    groups <span class="op">=</span> [df.loc[df[target] <span class="op">==</span> t, feature].dropna() <span class="cf">for</span> t <span class="kw">in</span> <span class="bu">sorted</span>(df[target].dropna().unique())]</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">7</span>, <span class="dv">4</span>))</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>    plt.boxplot(groups, labels<span class="op">=</span>[<span class="ss">f"</span><span class="sc">{</span>target<span class="sc">}</span><span class="ss">=</span><span class="sc">{</span>t<span class="sc">}</span><span class="ss">"</span> <span class="cf">for</span> t <span class="kw">in</span> <span class="bu">sorted</span>(df[target].dropna().unique())])</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="ss">f"</span><span class="sc">{</span>feature<span class="sc">}</span><span class="ss"> względem </span><span class="sc">{</span>target<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(feature)</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>box_by_target(df, <span class="st">"avg_basket_eur"</span>)</span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>box_by_target(df, <span class="st">"visits_last30"</span>)</span></code></pre></div><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="02-przygotowanie-danych_files/figure-html/cell-38-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-7"><img src="02-przygotowanie-danych_files/figure-html/cell-38-output-1.png" width="661" height="373" class="figure-img"></a></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="02-przygotowanie-danych_files/figure-html/cell-38-output-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-8"><img src="02-przygotowanie-danych_files/figure-html/cell-38-output-2.png" width="661" height="373" class="figure-img"></a></p>
</figure>
</div>
</div>
</div>
<p>Dla zmiennych kategorycznych przydatne są wykresy udziałów klas w kategoriach (np. wskaźnik <em>churn</em> w segmentach). W prostym wariancie liczymy średnią <code>churned</code> w grupach (to jest odsetek „1” w danej kategorii) i wykreślamy słupki.</p>
<div id="6802e7bf" class="cell" data-execution_count="38">
<details open="" class="code-fold">
<summary>Kod</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>rate <span class="op">=</span> df.groupby(<span class="st">"segment"</span>)[<span class="st">"churned"</span>].mean().sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">7</span>, <span class="dv">4</span>))</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>plt.bar(rate.index.astype(<span class="bu">str</span>), rate.values)</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Średni churn w segmentach"</span>)</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"P(churned=1)"</span>)</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">20</span>, ha<span class="op">=</span><span class="st">"right"</span>)</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="02-przygotowanie-danych_files/figure-html/cell-39-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-9"><img src="02-przygotowanie-danych_files/figure-html/cell-39-output-1.png" width="661" height="374" class="figure-img"></a></p>
</figure>
</div>
</div>
</div>
<p>Jeżeli w danych występują daty, dobrze jest wykonać podstawowe przekroje czasowe: liczba rejestracji w czasie, średni koszyk w czasie, itp. Pozwala to zidentyfikować sezonowość, zmiany procesu zbierania danych, kampanie marketingowe.</p>
<div id="742e609e" class="cell" data-execution_count="39">
<details open="" class="code-fold">
<summary>Kod</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>tmp <span class="op">=</span> df.copy()</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>tmp[<span class="st">"signup_month"</span>] <span class="op">=</span> tmp[<span class="st">"signup_date"</span>].dt.to_period(<span class="st">"M"</span>).dt.to_timestamp()</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>counts <span class="op">=</span> tmp.groupby(<span class="st">"signup_month"</span>)[<span class="st">"customer_id"</span>].count()</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">4</span>))</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>plt.plot(counts.index, counts.values)</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Liczba rejestracji w czasie"</span>)</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Liczność"</span>)</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Miesiąc"</span>)</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="02-przygotowanie-danych_files/figure-html/cell-40-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-10"><img src="02-przygotowanie-danych_files/figure-html/cell-40-output-1.png" width="947" height="372" class="figure-img"></a></p>
</figure>
</div>
</div>
</div>
<p>Na tym etapie jedynie notujemy, czy widać: braki danych (np. całe grupy z brakami), wartości podejrzanie ekstremalne lub naruszenia domeny. Szczegółowe postępowanie (imputacja, outliery) realizujemy według strategii opisanych w dedykowanych podrozdziałach.</p>
<section id="narzędzia-i-biblioteki" class="level4" data-number="3.3.3.1">
<h4 data-number="3.3.3.1" class="anchored" data-anchor-id="narzędzia-i-biblioteki"><span class="header-section-number">3.3.3.1</span> Narzędzia i biblioteki</h4>
<p>W praktycznej EDA najczęściej bazuje się na zestawie narzędzi „rdzeniowych”: <code>pandas</code> służy do przeglądu struktury danych, typów, braków, agregacji i podstawowych statystyk, natomiast <code>matplotlib</code> i <code>seaborn</code> odpowiadają za wizualizacje. <code>matplotlib</code> daje pełną kontrolę nad wykresem i jest dobry do precyzyjnych, publikacyjnych rysunków, a <code>seaborn</code> pozwala szybciej tworzyć estetyczne wykresy statystyczne typowe dla EDA (rozkłady, zależności, porównania grup). Jeżeli zależy Ci na interaktywności (zoom, podgląd wartości, selekcja), warto sięgnąć po <code>plotly</code> albo <code>altair</code>, które dobrze sprawdzają się w notebookach i podczas zajęć, bo ułatwiają „badanie danych w locie”.</p>
<p>Do szybkiej diagnostyki całego zbioru danych, bez ręcznego pisania wielu wykresów i tabel, przydatne są biblioteki raportujące: <code>ydata-profiling</code> (dawniej <code>pandas-profiling</code>) oraz <code>sweetviz</code>. Generują one raporty HTML z podsumowaniami rozkładów, braków, korelacji i potencjalnych problemów jakościowych, a <code>sweetviz</code> dodatkowo dobrze nadaje się do porównywania zbiorów (np. train vs test) lub analiz w odniesieniu do zmiennej docelowej. Z kolei <code>dtale</code> daje interfejs „jak arkusz kalkulacyjny”, umożliwiając interaktywne filtrowanie i szybkie sprawdzanie danych w przeglądarce, co bywa bardzo wygodne w dydaktyce i debugowaniu.</p>
<p>Jeżeli chcemy rozszerzyć EDA o wątki jakości danych i zależności specyficznych dla danych mieszanych, pomocne są narzędzia wyspecjalizowane: <code>missingno</code> służy do wizualizacji wzorców braków (gdzie i jak współwystępują), <code>great_expectations</code> pozwala formalizować reguły jakości danych i testować je w sposób powtarzalny, a <code>phik</code> bywa użyteczne do badania zależności również wtedy, gdy zmienne są kategoryczne lub relacje są nieliniowe. W praktyce dobry „stos” do Twojego kursu to: <code>pandas</code> + (<code>matplotlib</code>/<code>seaborn</code>) jako fundament, <code>missingno</code> do braków oraz <code>ydata-profiling</code> lub <code>sweetviz</code> do szybkiego raportu całości.</p>
</section>
</section>
<section id="preprocessing---przygotowanie-macierzy-cech-do-modeli" class="level3" data-number="3.3.4">
<h3 data-number="3.3.4" class="anchored" data-anchor-id="preprocessing---przygotowanie-macierzy-cech-do-modeli"><span class="header-section-number">3.3.4</span> Preprocessing - przygotowanie macierzy cech do modeli</h3>
<p>Po EDA przechodzimy do preprocessingu, którego cel jest stricte „modelowy”: wytworzyć wejście w formacie akceptowalnym przez algorytmy oraz zapewnić powtarzalność transformacji. Kluczowa zasada brzmi: transformacje, które uczą się parametrów (<code>imputer</code>, <code>scaler</code>, <code>encoder</code>), dopasowujemy na zbiorze treningowym i stosujemy do walidacji/testu – najlepiej w pipeline.</p>
<section id="podział-na-zbiory-treningowy-i-testowy" class="level4" data-number="3.3.4.1">
<h4 data-number="3.3.4.1" class="anchored" data-anchor-id="podział-na-zbiory-treningowy-i-testowy"><span class="header-section-number">3.3.4.1</span> Podział na zbiory treningowy i testowy</h4>
<p>Podział na train/test wykonujemy przed dopasowaniem transformacji. Dla klasyfikacji zwykle stosujemy stratyfikację.</p>
<div id="f9d1f08e" class="cell" data-execution_count="40">
<details open="" class="code-fold">
<summary>Kod</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> df.drop(columns<span class="op">=</span>[<span class="st">"churned"</span>])</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> df[<span class="st">"churned"</span>]</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>    X, y, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state<span class="op">=</span><span class="dv">42</span>, stratify<span class="op">=</span>y</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<p>Jeżeli dodatkowo używamy walidacji, możemy wydzielić <code>X_val</code> z <code>X_train</code> analogicznie albo korzystać z <em>cross-validation</em>.</p>
</section>
<section id="kodowanie-kategorii" class="level4" data-number="3.3.4.2">
<h4 data-number="3.3.4.2" class="anchored" data-anchor-id="kodowanie-kategorii"><span class="header-section-number">3.3.4.2</span> Kodowanie kategorii</h4>
<p>Większość klasycznych modeli (regresja logistyczna, SVM, LDA/QDA) wymaga liczb, więc zmienne kategoryczne kodujemy. Standardem jest <em>one-hot encoding</em> z obsługą nieznanych kategorii w teście.</p>
</section>
<section id="skalowanie-zmiennych-liczbowych" class="level4" data-number="3.3.4.3">
<h4 data-number="3.3.4.3" class="anchored" data-anchor-id="skalowanie-zmiennych-liczbowych"><span class="header-section-number">3.3.4.3</span> Skalowanie zmiennych liczbowych</h4>
<p>Skalowanie jest szczególnie ważne dla metod opartych na odległości i marginesie (k-NN, SVM) oraz dla modeli liniowych przy regularyzacji. Dla drzew i metod zespołowych zwykle nie jest konieczne, ale utrzymywanie jednolitego pipeline’u ułatwia porównania.</p>
</section>
<section id="pipeline-preprocessingu" class="level4" data-number="3.3.4.4">
<h4 data-number="3.3.4.4" class="anchored" data-anchor-id="pipeline-preprocessingu"><span class="header-section-number">3.3.4.4</span> Pipeline preprocessingu</h4>
<p>Poniżej wzorcowa konstrukcja preprocessingu: dla liczb imputacja (tu jako placeholder) + skalowanie; dla kategorii imputacja (placeholder) + one-hot encoding. Strategię imputacji i obsługę outlierów możesz później łatwo podmienić.</p>
<div id="b6debb95" class="cell" data-execution_count="41">
<details open="" class="code-fold">
<summary>Kod</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>num_cols <span class="op">=</span> [<span class="st">"age"</span>, <span class="st">"income_eur"</span>, <span class="st">"visits_last30"</span>, <span class="st">"avg_basket_eur"</span>, <span class="st">"returns_last90"</span>, <span class="st">"satisfaction_1_5"</span>]</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>cat_cols <span class="op">=</span> [<span class="st">"city"</span>, <span class="st">"segment"</span>, <span class="st">"device_type"</span>, <span class="st">"has_promo"</span>, <span class="st">"notes"</span>]</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>numeric_pipe <span class="op">=</span> Pipeline(steps<span class="op">=</span>[</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"imputer"</span>, SimpleImputer(strategy<span class="op">=</span><span class="st">"median"</span>)),   <span class="co"># szczegóły w rozdziale o imputacji</span></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"scaler"</span>, StandardScaler())</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>categorical_pipe <span class="op">=</span> Pipeline(steps<span class="op">=</span>[</span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"imputer"</span>, SimpleImputer(strategy<span class="op">=</span><span class="st">"most_frequent"</span>)),</span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"onehot"</span>, OneHotEncoder(handle_unknown<span class="op">=</span><span class="st">"ignore"</span>))</span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a>preprocess <span class="op">=</span> ColumnTransformer(</span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a>    transformers<span class="op">=</span>[</span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a>        (<span class="st">"num"</span>, numeric_pipe, num_cols),</span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a>        (<span class="st">"cat"</span>, categorical_pipe, cat_cols),</span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb50-21"><a href="#cb50-21" aria-hidden="true" tabindex="-1"></a>    remainder<span class="op">=</span><span class="st">"drop"</span></span>
<span id="cb50-22"><a href="#cb50-22" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<p>Następnie łączymy preprocessing z modelem w jeden pipeline. Dzięki temu cały proces jest powtarzalny i bezpieczny względem testu:</p>
<div id="de36b412" class="cell" data-execution_count="42">
<details open="" class="code-fold">
<summary>Kod</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>clf <span class="op">=</span> Pipeline(steps<span class="op">=</span>[</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"prep"</span>, preprocess),</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"model"</span>, LogisticRegression(max_iter<span class="op">=</span><span class="dv">300</span>))</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>clf.fit(X_train, y_train)</span></code></pre></div><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="40">
<style>#sk-container-id-2 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: black;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-2 {
  color: var(--sklearn-color-text);
}

#sk-container-id-2 pre {
  padding: 0;
}

#sk-container-id-2 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-2 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-2 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-2 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-2 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-2 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-2 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-2 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-2 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-2 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-2 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-2 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-2 label.sk-toggleable__label {
  cursor: pointer;
  display: block;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
}

#sk-container-id-2 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-2 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-2 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-2 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-2 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-2 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-2 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-2 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-2 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-2 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-2 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-2 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-2 div.sk-label label.sk-toggleable__label,
#sk-container-id-2 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-2 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-2 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-2 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-2 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-2 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-2 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-2 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-2 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 1ex;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-2 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-2 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-2 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-2 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div id="sk-container-id-2" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>Pipeline(steps=[('prep',
                 ColumnTransformer(transformers=[('num',
                                                  Pipeline(steps=[('imputer',
                                                                   SimpleImputer(strategy='median')),
                                                                  ('scaler',
                                                                   StandardScaler())]),
                                                  ['age', 'income_eur',
                                                   'visits_last30',
                                                   'avg_basket_eur',
                                                   'returns_last90',
                                                   'satisfaction_1_5']),
                                                 ('cat',
                                                  Pipeline(steps=[('imputer',
                                                                   SimpleImputer(strategy='most_frequent')),
                                                                  ('onehot',
                                                                   OneHotEncoder(handle_unknown='ignore'))]),
                                                  ['city', 'segment',
                                                   'device_type', 'has_promo',
                                                   'notes'])])),
                ('model', LogisticRegression(max_iter=300))])</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-9" type="checkbox"><label for="sk-estimator-id-9" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;&nbsp;Pipeline<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.5/modules/generated/sklearn.pipeline.Pipeline.html">?<span>Documentation for Pipeline</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></label><div class="sk-toggleable__content fitted"><pre>Pipeline(steps=[('prep',
                 ColumnTransformer(transformers=[('num',
                                                  Pipeline(steps=[('imputer',
                                                                   SimpleImputer(strategy='median')),
                                                                  ('scaler',
                                                                   StandardScaler())]),
                                                  ['age', 'income_eur',
                                                   'visits_last30',
                                                   'avg_basket_eur',
                                                   'returns_last90',
                                                   'satisfaction_1_5']),
                                                 ('cat',
                                                  Pipeline(steps=[('imputer',
                                                                   SimpleImputer(strategy='most_frequent')),
                                                                  ('onehot',
                                                                   OneHotEncoder(handle_unknown='ignore'))]),
                                                  ['city', 'segment',
                                                   'device_type', 'has_promo',
                                                   'notes'])])),
                ('model', LogisticRegression(max_iter=300))])</pre></div> </div></div><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-10" type="checkbox"><label for="sk-estimator-id-10" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;prep: ColumnTransformer<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.5/modules/generated/sklearn.compose.ColumnTransformer.html">?<span>Documentation for prep: ColumnTransformer</span></a></label><div class="sk-toggleable__content fitted"><pre>ColumnTransformer(transformers=[('num',
                                 Pipeline(steps=[('imputer',
                                                  SimpleImputer(strategy='median')),
                                                 ('scaler', StandardScaler())]),
                                 ['age', 'income_eur', 'visits_last30',
                                  'avg_basket_eur', 'returns_last90',
                                  'satisfaction_1_5']),
                                ('cat',
                                 Pipeline(steps=[('imputer',
                                                  SimpleImputer(strategy='most_frequent')),
                                                 ('onehot',
                                                  OneHotEncoder(handle_unknown='ignore'))]),
                                 ['city', 'segment', 'device_type', 'has_promo',
                                  'notes'])])</pre></div> </div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-11" type="checkbox"><label for="sk-estimator-id-11" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">num</label><div class="sk-toggleable__content fitted"><pre>['age', 'income_eur', 'visits_last30', 'avg_basket_eur', 'returns_last90', 'satisfaction_1_5']</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-12" type="checkbox"><label for="sk-estimator-id-12" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;SimpleImputer<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.5/modules/generated/sklearn.impute.SimpleImputer.html">?<span>Documentation for SimpleImputer</span></a></label><div class="sk-toggleable__content fitted"><pre>SimpleImputer(strategy='median')</pre></div> </div></div><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-13" type="checkbox"><label for="sk-estimator-id-13" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;StandardScaler<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.5/modules/generated/sklearn.preprocessing.StandardScaler.html">?<span>Documentation for StandardScaler</span></a></label><div class="sk-toggleable__content fitted"><pre>StandardScaler()</pre></div> </div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-14" type="checkbox"><label for="sk-estimator-id-14" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">cat</label><div class="sk-toggleable__content fitted"><pre>['city', 'segment', 'device_type', 'has_promo', 'notes']</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-15" type="checkbox"><label for="sk-estimator-id-15" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;SimpleImputer<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.5/modules/generated/sklearn.impute.SimpleImputer.html">?<span>Documentation for SimpleImputer</span></a></label><div class="sk-toggleable__content fitted"><pre>SimpleImputer(strategy='most_frequent')</pre></div> </div></div><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-16" type="checkbox"><label for="sk-estimator-id-16" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;OneHotEncoder<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.5/modules/generated/sklearn.preprocessing.OneHotEncoder.html">?<span>Documentation for OneHotEncoder</span></a></label><div class="sk-toggleable__content fitted"><pre>OneHotEncoder(handle_unknown='ignore')</pre></div> </div></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-17" type="checkbox"><label for="sk-estimator-id-17" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;LogisticRegression<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.5/modules/generated/sklearn.linear_model.LogisticRegression.html">?<span>Documentation for LogisticRegression</span></a></label><div class="sk-toggleable__content fitted"><pre>LogisticRegression(max_iter=300)</pre></div> </div></div></div></div></div></div>
</div>
</div>
</section>
</section>
</section>
<section id="inżynieria-cech" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="inżynieria-cech"><span class="header-section-number">3.4</span> Inżynieria cech</h2>
<p>Inżynieria cech (<em>feature engineering</em>) to etap, w którym surowe dane przekształcamy w reprezentację bardziej użyteczną dla modeli uczenia maszynowego. Jej celem nie jest „upiększanie” danych, lecz zwiększenie ilości informacji, jaką model może efektywnie wykorzystać, oraz dopasowanie formatu cech do wymagań algorytmów. W praktyce inżynieria cech obejmuje zarówno proste transformacje (np. logarytmowanie zmiennej skośnej), jak i budowę cech pochodnych, interakcji, agregacji czy cech czasowych. W tym kursie inżynieria cech jest szczególnie istotna, ponieważ omawiane modele klasyczne (regresja logistyczna, LDA/QDA, SVM, k-NN) są wrażliwe na sposób reprezentacji danych i często korzystają bardziej z dobrze zaprojektowanych cech niż z samej „mocy” algorytmu.</p>
<section id="ujednolicanie-i-czyszczenie-kategorii-jako-element-inżynierii-cech" class="level3" data-number="3.4.1">
<h3 data-number="3.4.1" class="anchored" data-anchor-id="ujednolicanie-i-czyszczenie-kategorii-jako-element-inżynierii-cech"><span class="header-section-number">3.4.1</span> Ujednolicanie i czyszczenie kategorii jako element inżynierii cech</h3>
<p>Zanim zakodujemy kategorie, warto je znormalizować, ponieważ w danych rzeczywistych często występują spacje, różne wielkości liter oraz warianty zapisu tej samej kategorii. To nie jest „czyszczenie kosmetyczne” – bez tego model będzie traktował np. <code>Mobile</code> i <code>mobile</code> jako różne wartości, co rozbije informację na wiele sztucznych kategorii.</p>
<div id="d1fb31dc" class="cell" data-execution_count="43">
<details open="" class="code-fold">
<summary>Kod</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ujednolicenie prostych kolumn kategorycznych</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> [<span class="st">"city"</span>, <span class="st">"segment"</span>, <span class="st">"device_type"</span>, <span class="st">"notes"</span>]:</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>    df[col] <span class="op">=</span> (df[col]</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>               .astype(<span class="st">"string"</span>)</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>               .<span class="bu">str</span>.strip()</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>               .<span class="bu">str</span>.lower())</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a><span class="co"># przykładowo: ujednolicenie nazw urządzeń</span></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"device_type"</span>] <span class="op">=</span> df[<span class="st">"device_type"</span>].replace({<span class="st">"mobile"</span>: <span class="st">"mobile"</span>, <span class="st">"desktop"</span>: <span class="st">"desktop"</span>, <span class="st">"tablet"</span>: <span class="st">"tablet"</span>})</span></code></pre></div><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<p>W wielu projektach opłaca się również „skleić” rzadkie kategorie do wspólnej kategorii <code>other</code>, aby ograniczyć wymiar po kodowaniu one-hot.</p>
<div id="87913b53" class="cell" data-execution_count="44">
<details open="" class="code-fold">
<summary>Kod</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>top_cities <span class="op">=</span> df[<span class="st">"city"</span>].value_counts().head(<span class="dv">6</span>).index</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"city_reduced"</span>] <span class="op">=</span> df[<span class="st">"city"</span>].where(df[<span class="st">"city"</span>].isin(top_cities), other<span class="op">=</span><span class="st">"other"</span>)</span></code></pre></div><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section>
<section id="cechy-czasowe-z-dat" class="level3" data-number="3.4.2">
<h3 data-number="3.4.2" class="anchored" data-anchor-id="cechy-czasowe-z-dat"><span class="header-section-number">3.4.2</span> Cechy czasowe z dat</h3>
<p>Daty rzadko trafiają do modelu w postaci surowej. Zwykle tworzy się z nich cechy o sensie behawioralnym: czas od zdarzenia, miesiąc, dzień tygodnia, czy wskaźniki sezonowe. Dla danych klient–zakupy naturalne są cechy typu <em>tenure</em> oraz <em>recency</em>.</p>
<p>Niech „datą odniesienia” będzie np. maksymalna obserwowana data zakupu (w realnym projekcie byłby to moment <em>as-of</em>).</p>
<div id="ae2aa55d" class="cell" data-execution_count="45">
<details open="" class="code-fold">
<summary>Kod</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>as_of <span class="op">=</span> df[<span class="st">"last_purchase_date"</span>].<span class="bu">max</span>()</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"tenure_days"</span>] <span class="op">=</span> (as_of <span class="op">-</span> df[<span class="st">"signup_date"</span>]).dt.days</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"recency_days"</span>] <span class="op">=</span> (as_of <span class="op">-</span> df[<span class="st">"last_purchase_date"</span>]).dt.days</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a><span class="co"># sezonowość i kalendarz</span></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"signup_month"</span>] <span class="op">=</span> df[<span class="st">"signup_date"</span>].dt.month</span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"signup_dow"</span>] <span class="op">=</span> df[<span class="st">"signup_date"</span>].dt.dayofweek  <span class="co"># 0=pon, 6=niedz</span></span></code></pre></div><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<p>Takie cechy są zwykle dużo bardziej informacyjne dla klasyfikacji churn niż same daty, ponieważ mają bezpośredni związek z aktywnością klienta.</p>
</section>
<section id="transformacje-rozkładów" class="level3" data-number="3.4.3">
<h3 data-number="3.4.3" class="anchored" data-anchor-id="transformacje-rozkładów"><span class="header-section-number">3.4.3</span> Transformacje rozkładów</h3>
<p>W danych ekonomicznych i behawioralnych (np. <code>income_eur</code>, <code>avg_basket_eur</code>) rozkłady są często prawoskośne. Dla modeli liniowych oraz metod odległościowych zyskujemy, gdy przekształcimy skalę tak, aby relacje były bardziej „liniowe” i mniej zdominowane przez ogon rozkładu.</p>
<p>Standardowa transformacja logarytmiczna (z zabezpieczeniem na zera) to:</p>
<p><span class="math display">\[
x' = \log(1 + x).
\]</span></p>
<div id="7d8698fd" class="cell" data-execution_count="46">
<details open="" class="code-fold">
<summary>Kod</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"log_income"</span>] <span class="op">=</span> np.log1p(df[<span class="st">"income_eur"</span>])</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"log_avg_basket"</span>] <span class="op">=</span> np.log1p(df[<span class="st">"avg_basket_eur"</span>])</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"log_visits"</span>] <span class="op">=</span> np.log1p(df[<span class="st">"visits_last30"</span>])</span></code></pre></div><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<p>W praktyce często lepsze jest utrzymywanie zarówno cechy pierwotnej, jak i przekształconej – modele drzewiaste zwykle skorzystają z obu, a modele liniowe częściej z wersji log.</p>
</section>
<section id="cechy-intensywności-i-normalizacja-przez-czas-rate-features" class="level3" data-number="3.4.4">
<h3 data-number="3.4.4" class="anchored" data-anchor-id="cechy-intensywności-i-normalizacja-przez-czas-rate-features"><span class="header-section-number">3.4.4</span> Cechy intensywności i „normalizacja przez czas” (<em>rate features</em>)</h3>
<p>Typowym zabiegiem jest tworzenie cech typu „na jednostkę czasu”. Jeśli klient jest w systemie krótko, jego liczby bezwzględne mogą być nieporównywalne do klienta z długim stażem. Stąd tworzy się wskaźniki intensywności:</p>
<div id="ac11861b" class="cell" data-execution_count="47">
<details open="" class="code-fold">
<summary>Kod</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># zabezpieczenie przed dzieleniem przez 0</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"tenure_days_safe"</span>] <span class="op">=</span> df[<span class="st">"tenure_days"</span>].clip(lower<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"visits_per_day"</span>] <span class="op">=</span> df[<span class="st">"visits_last30"</span>] <span class="op">/</span> <span class="fl">30.0</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"returns_rate_90"</span>] <span class="op">=</span> df[<span class="st">"returns_last90"</span>] <span class="op">/</span> <span class="fl">90.0</span></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"visits_per_tenure"</span>] <span class="op">=</span> df[<span class="st">"visits_last30"</span>] <span class="op">/</span> df[<span class="st">"tenure_days_safe"</span>]</span></code></pre></div><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<p>Te cechy są szczególnie wartościowe w klasycznych modelach liniowych, bo stabilizują skalę i często lepiej korelują z decyzją niż wartości surowe.</p>
</section>
<section id="interakcje-i-cechy-biznesowe-z-sensowną-interpretacją" class="level3" data-number="3.4.5">
<h3 data-number="3.4.5" class="anchored" data-anchor-id="interakcje-i-cechy-biznesowe-z-sensowną-interpretacją"><span class="header-section-number">3.4.5</span> Interakcje i cechy „biznesowe” z sensowną interpretacją</h3>
<p>Interakcje to bardzo ważna klasa cech w klasycznych modelach. Jeżeli nie używasz modeli, które „same” łatwo uczą się złożonych interakcji (np. boosting), to możesz jawnie dodać kilka logicznych interakcji. Przykładowo: wartość koszyka może działać inaczej dla segmentu VIP, a liczba wizyt może inaczej wpływać na churn, gdy satysfakcja jest niska.</p>
<div id="ceafd17d" class="cell" data-execution_count="48">
<details open="" class="code-fold">
<summary>Kod</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># przykładowe interakcje liczbowe</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"basket_x_visits"</span>] <span class="op">=</span> df[<span class="st">"avg_basket_eur"</span>] <span class="op">*</span> df[<span class="st">"visits_last30"</span>]</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"income_x_visits"</span>] <span class="op">=</span> df[<span class="st">"income_eur"</span>] <span class="op">*</span> df[<span class="st">"visits_last30"</span>]</span></code></pre></div><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<p>Możemy również budować interakcje „warunkowe”, np. flaga „niska satysfakcja” i interakcja z wizytami:</p>
<div id="08721591" class="cell" data-execution_count="49">
<details open="" class="code-fold">
<summary>Kod</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"low_satisfaction"</span>] <span class="op">=</span> (df[<span class="st">"satisfaction_1_5"</span>] <span class="op">&lt;=</span> <span class="dv">2</span>).astype(<span class="bu">int</span>)</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"visits_if_low_satisfaction"</span>] <span class="op">=</span> df[<span class="st">"visits_last30"</span>] <span class="op">*</span> df[<span class="st">"low_satisfaction"</span>]</span></code></pre></div><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<p>To jest szczególnie dydaktyczne, bo pokazuje, jak złożone hipotezy można przenieść do prostego modelu.</p>
</section>
<section id="grupowanie-zmiennych-ciągłych-do-przedziałów-binning" class="level3" data-number="3.4.6">
<h3 data-number="3.4.6" class="anchored" data-anchor-id="grupowanie-zmiennych-ciągłych-do-przedziałów-binning"><span class="header-section-number">3.4.6</span> Grupowanie zmiennych ciągłych do przedziałów (<em>binning</em>)</h3>
<p>Czasem warto przekształcić zmienną ciągłą do kategorii, zwłaszcza gdy zależność jest progowa. Przykładowo: <code>recency_days</code> może mieć silny efekt dopiero po przekroczeniu pewnego progu. Binning bywa użyteczny też w analizie dyskryminacyjnej i prostych modelach interpretowalnych.</p>
<div id="5c37e097" class="cell" data-execution_count="50">
<details open="" class="code-fold">
<summary>Kod</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"recency_bin"</span>] <span class="op">=</span> pd.cut(</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"recency_days"</span>],</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>    bins<span class="op">=</span>[<span class="op">-</span><span class="dv">1</span>, <span class="dv">7</span>, <span class="dv">30</span>, <span class="dv">90</span>, <span class="dv">180</span>, <span class="dv">365</span>, <span class="dv">10_000</span>],</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>    labels<span class="op">=</span>[<span class="st">"&lt;=7"</span>, <span class="st">"8-30"</span>, <span class="st">"31-90"</span>, <span class="st">"91-180"</span>, <span class="st">"181-365"</span>, <span class="st">"&gt;365"</span>]</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section>
<section id="kodowanie-kategorii-pod-modele" class="level3" data-number="3.4.7">
<h3 data-number="3.4.7" class="anchored" data-anchor-id="kodowanie-kategorii-pod-modele"><span class="header-section-number">3.4.7</span> Kodowanie kategorii pod modele</h3>
<p>Najbardziej standardowym kodowaniem jest <em>one-hot encoding</em>. Możemy je zrobić w <code>pandas</code>, ale w modelowaniu lepszy jest pipeline w <code>sklearn</code>. Dla celów EDA i demonstracji:</p>
<div id="f779b217" class="cell" data-execution_count="51">
<details open="" class="code-fold">
<summary>Kod</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>X_cat <span class="op">=</span> pd.get_dummies(df[[<span class="st">"segment"</span>, <span class="st">"device_type"</span>, <span class="st">"city_reduced"</span>]], dummy_na<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>X_cat.head()</span></code></pre></div><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="49">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">segment_b2b</th>
<th data-quarto-table-cell-role="th">segment_b2c</th>
<th data-quarto-table-cell-role="th">segment_student</th>
<th data-quarto-table-cell-role="th">segment_vip</th>
<th data-quarto-table-cell-role="th">segment_&lt;NA&gt;</th>
<th data-quarto-table-cell-role="th">device_type_desktop</th>
<th data-quarto-table-cell-role="th">device_type_mobile</th>
<th data-quarto-table-cell-role="th">device_type_tablet</th>
<th data-quarto-table-cell-role="th">device_type_&lt;NA&gt;</th>
<th data-quarto-table-cell-role="th">city_reduced_katowice</th>
<th data-quarto-table-cell-role="th">city_reduced_kraków</th>
<th data-quarto-table-cell-role="th">city_reduced_lublin</th>
<th data-quarto-table-cell-role="th">city_reduced_other</th>
<th data-quarto-table-cell-role="th">city_reduced_poznań</th>
<th data-quarto-table-cell-role="th">city_reduced_wrocław</th>
<th data-quarto-table-cell-role="th">city_reduced_łódź</th>
<th data-quarto-table-cell-role="th">city_reduced_&lt;NA&gt;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>True</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>True</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>True</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>False</td>
<td>True</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>True</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>True</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>False</td>
<td>True</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>True</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>True</td>
<td>False</td>
<td>False</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>True</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>True</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>True</td>
<td>False</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>False</td>
<td>True</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>True</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>True</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="składanie-cech-do-macierzy-modelowej" class="level3" data-number="3.4.8">
<h3 data-number="3.4.8" class="anchored" data-anchor-id="składanie-cech-do-macierzy-modelowej"><span class="header-section-number">3.4.8</span> Składanie cech do macierzy modelowej</h3>
<p>Po inżynierii cech zwykle wybieramy zestaw kolumn do modelu. Na potrzeby naszych klasycznych algorytmów rozsądne jest przygotowanie „bazowego” zestawu cech liczbowych oraz zakodowanych kategorii.</p>
<div id="2d790db4" class="cell" data-execution_count="52">
<details open="" class="code-fold">
<summary>Kod</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>feature_cols_num <span class="op">=</span> [</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"tenure_days"</span>, <span class="st">"recency_days"</span>,</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"income_eur"</span>, <span class="st">"avg_basket_eur"</span>, <span class="st">"visits_last30"</span>, <span class="st">"returns_last90"</span>,</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"log_income"</span>, <span class="st">"log_avg_basket"</span>, <span class="st">"log_visits"</span>,</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"visits_per_day"</span>, <span class="st">"returns_rate_90"</span>,</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"low_satisfaction"</span>, <span class="st">"basket_x_visits"</span></span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>feature_cols_cat <span class="op">=</span> [<span class="st">"segment"</span>, <span class="st">"device_type"</span>, <span class="st">"city_reduced"</span>, <span class="st">"recency_bin"</span>]</span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>X_num <span class="op">=</span> df[feature_cols_num]</span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a>X_cat <span class="op">=</span> pd.get_dummies(df[feature_cols_cat], dummy_na<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> pd.concat([X_num, X_cat], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> df[<span class="st">"churned"</span>]</span></code></pre></div><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Adnotacja
</div>
</div>
<div class="callout-body-container callout-body">
<p>Przedstawione powyżej przykłady inżynierii cech mają charakter ilustracyjny i służą pokazaniu typowych mechanizmów oraz kierunków pracy z danymi. W kontekście konkretnego problemu analitycznego część tych kroków może zostać zmodyfikowana, uproszczona lub całkowicie pominięta, a inne – niewystępujące w przykładach – mogą okazać się kluczowe. Inżynieria cech nie jest zestawem sztywnych reguł, lecz procesem zależnym od charakteru danych, celu analizy oraz stosowanego modelu.</p>
<p>W praktyce najlepszym podejściem jest realizowanie inżynierii cech w sposób systematyczny i powtarzalny, z wykorzystaniem <em>pipeline’ów</em>. Pozwala to połączyć imputację, skalowanie, kodowanie oraz konstrukcję cech w jeden spójny proces, który jest dopasowywany wyłącznie na zbiorze treningowym i następnie stosowany do walidacji oraz testu. Takie podejście minimalizuje ryzyko wycieku informacji, ułatwia porównywanie modeli oraz sprawia, że eksperymenty analityczne są w pełni reprodukowalne.</p>
</div>
</div>


</section>
</section>


</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Skopiowano!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Skopiowano!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../chapters/01-wprowadzenie.html" class="pagination-link" aria-label="Wprowadzenie i historia">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Wprowadzenie i historia</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../chapters/03-klasyfikacja-liniowa.html" class="pagination-link" aria-label="Klasyfikacja liniowa">
        <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Klasyfikacja liniowa</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Eksploracja danych i uczenie maszynowe</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/DariuszMajerek/eksploracja-danych-uczenie-maszynowe/issues/new" class="toc-action"><i class="bi bi-github"></i>Zgłoś problem</a></li></ul></div></div>
    <div class="nav-footer-right">
<p>Dariusz Majerek ©2025</p>
</div>
  </div>
</footer>
<script>var lightboxQuarto = GLightbox({"closeEffect":"zoom","descPosition":"bottom","loop":false,"openEffect":"zoom","selector":".lightbox"});
(function() {
  let previousOnload = window.onload;
  window.onload = () => {
    if (previousOnload) {
      previousOnload();
    }
    lightboxQuarto.on('slide_before_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      const href = trigger.getAttribute('href');
      if (href !== null) {
        const imgEl = window.document.querySelector(`a[href="${href}"] img`);
        if (imgEl !== null) {
          const srcAttr = imgEl.getAttribute("src");
          if (srcAttr && srcAttr.startsWith("data:")) {
            slideConfig.href = srcAttr;
          }
        }
      } 
    });
  
    lightboxQuarto.on('slide_after_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(slideNode);
      }
    });
  
  };
  
})();
          </script>




</body></html>